{{ $disableImageOptimization := .Site.Params.disableImageOptimization | default false }}
<style>
/* Global Background Styles - Applied to all pages */
.global-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -10;
  overflow: hidden;
  pointer-events: none;
}

.global-background img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Ensure body and main content are transparent to show background */
body {
  background: transparent !important;
  max-width: none !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

main#main-content {
  background: transparent !important;
  max-width: none !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

/* Unified frosted glass container - 80% width - GLOBAL STYLES */
.content-frosted-wrapper {
  width: 80% !important;
  max-width: none !important;
  margin: 2rem auto !important;
  background: rgba(255, 255, 255, 0.85) !important;
  backdrop-filter: blur(20px) !important;
  -webkit-backdrop-filter: blur(20px) !important;
  border-radius: 16px !important;
  padding: 3rem !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
  border: 1px solid rgba(255, 255, 255, 0.3) !important;
  position: relative;
  z-index: 1;
}

.dark .content-frosted-wrapper {
  background: rgba(30, 30, 30, 0.85) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

/* COMPLETELY REMOVE all backgrounds from ALL internal elements - GLOBAL - HIGHEST PRIORITY */
/* 注意：表格元素在后面的规则中单独处理 */
html body main#main-content .content-frosted-wrapper *,
html body main#main-content .content-frosted-wrapper *::before,
html body main#main-content .content-frosted-wrapper *::after,
.content-frosted-wrapper *,
.content-frosted-wrapper *::before,
.content-frosted-wrapper *::after {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  box-shadow: none !important;
  border: none !important;
  border-radius: 0 !important;
  border-color: transparent !important;
}

/* 表格元素例外 - 允许表格样式正常显示，并应用自定义样式 */
html body main#main-content .content-frosted-wrapper .prose table,
html body main#main-content .content-frosted-wrapper .article-content .prose table,
html body main#main-content .content-frosted-wrapper article .prose table {
  display: table !important;
  background: rgba(255, 255, 255, 0.5) !important;
  background-color: rgba(255, 255, 255, 0.5) !important;
  background-image: none !important;
  width: 100% !important;
  max-width: 100% !important;
  min-width: 100% !important;
  border-collapse: collapse !important;
  margin: 1.5rem 0 !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
  font-size: 1.125rem !important;
  border: 1px solid rgba(255, 255, 255, 0.4) !important;
  border-radius: 12px !important;
  overflow: hidden !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
  backdrop-filter: blur(10px) !important;
  -webkit-backdrop-filter: blur(10px) !important;
  box-sizing: border-box !important;
  table-layout: auto !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose table,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose table,
.dark html body main#main-content .content-frosted-wrapper article .prose table {
  border-color: rgba(255, 255, 255, 0.12) !important;
  background: rgba(35, 35, 35, 0.5) !important;
  background-color: rgba(35, 35, 35, 0.5) !important;
}

html body main#main-content .content-frosted-wrapper .prose thead,
html body main#main-content .content-frosted-wrapper .article-content .prose thead,
html body main#main-content .content-frosted-wrapper article .prose thead {
  background: rgba(255, 255, 255, 0.7) !important;
  background-color: rgba(255, 255, 255, 0.7) !important;
  background-image: none !important;
  display: table-header-group !important;
  backdrop-filter: blur(10px) !important;
  -webkit-backdrop-filter: blur(10px) !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose thead,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose thead,
.dark html body main#main-content .content-frosted-wrapper article .prose thead {
  background: rgba(30, 30, 30, 0.55) !important;
  background-color: rgba(30, 30, 30, 0.55) !important;
}

html body main#main-content .content-frosted-wrapper .prose thead th,
html body main#main-content .content-frosted-wrapper .article-content .prose thead th,
html body main#main-content .content-frosted-wrapper article .prose thead th {
  background: rgba(255, 255, 255, 0.7) !important;
  background-color: rgba(255, 255, 255, 0.7) !important;
  background-image: none !important;
  padding: 0.875rem 1rem !important;
  text-align: left !important;
  font-weight: 600 !important;
  color: #1a1a1a !important;
  border: none !important;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
  border-right: 1px solid rgba(0, 0, 0, 0.08) !important;
  border-radius: 0 !important;
  font-size: 1.125rem !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose thead th,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose thead th,
.dark html body main#main-content .content-frosted-wrapper article .prose thead th {
  background: rgba(30, 30, 30, 0.55) !important;
  background-color: rgba(30, 30, 30, 0.55) !important;
  color: #d1d5db !important;
  border-bottom-color: rgba(255, 255, 255, 0.1) !important;
  border-right-color: rgba(255, 255, 255, 0.08) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody,
html body main#main-content .content-frosted-wrapper article .prose tbody {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody tr,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr,
html body main#main-content .content-frosted-wrapper article .prose tbody tr {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  border: none !important;
  border-bottom: 1px solid rgba(0, 0, 0, 0.08) !important;
  border-radius: 0 !important;
  transition: background-color 0.2s ease !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody tr,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr,
.dark html body main#main-content .content-frosted-wrapper article .prose tbody tr {
  border-bottom-color: rgba(255, 255, 255, 0.12) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(even),
html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(even),
html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(even) {
  background: rgba(255, 255, 255, 0.3) !important;
  background-color: rgba(255, 255, 255, 0.3) !important;
  background-image: none !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(even),
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(even),
.dark html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(even) {
  background: rgba(40, 40, 40, 0.35) !important;
  background-color: rgba(40, 40, 40, 0.35) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(odd),
html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(odd),
html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(odd) {
  background: rgba(255, 255, 255, 0.2) !important;
  background-color: rgba(255, 255, 255, 0.2) !important;
  background-image: none !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(odd),
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(odd),
.dark html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(odd) {
  background: rgba(38, 38, 38, 0.3) !important;
  background-color: rgba(38, 38, 38, 0.3) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody tr:hover,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:hover,
html body main#main-content .content-frosted-wrapper article .prose tbody tr:hover {
  background: rgba(255, 255, 255, 0.5) !important;
  background-color: rgba(255, 255, 255, 0.5) !important;
  background-image: none !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody tr:hover,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:hover,
.dark html body main#main-content .content-frosted-wrapper article .prose tbody tr:hover {
  background: rgba(48, 48, 48, 0.45) !important;
  background-color: rgba(48, 48, 48, 0.45) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody td,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody td,
html body main#main-content .content-frosted-wrapper article .prose tbody td {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  padding: 0.875rem 1rem !important;
  border: none !important;
  border-right: 1px solid rgba(0, 0, 0, 0.08) !important;
  border-radius: 0 !important;
  font-size: 1.125rem !important;
  line-height: 1.6 !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody td,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody td,
.dark html body main#main-content .content-frosted-wrapper article .prose tbody td {
  border-right-color: rgba(255, 255, 255, 0.12) !important;
}

html body main#main-content .content-frosted-wrapper .prose thead th:last-child,
html body main#main-content .content-frosted-wrapper .article-content .prose thead th:last-child,
html body main#main-content .content-frosted-wrapper article .prose thead th:last-child,
html body main#main-content .content-frosted-wrapper .prose tbody td:last-child,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody td:last-child,
html body main#main-content .content-frosted-wrapper article .prose tbody td:last-child {
  border-right: none !important;
  border-right-width: 0 !important;
  border-right-style: none !important;
  padding-right: 1rem !important;
}


/* Override all Tailwind bg- classes - GLOBAL - HIGHEST PRIORITY */
/* 排除表格元素 */
html body main#main-content .content-frosted-wrapper table [class*="bg-"],
html body main#main-content .content-frosted-wrapper table [class*="bg-neutral"],
html body main#main-content .content-frosted-wrapper table [class*="bg-white"],
html body main#main-content .content-frosted-wrapper table [class*="bg-gray"],
html body main#main-content .content-frosted-wrapper table [class*="bg-slate"],
.content-frosted-wrapper table [class*="bg-"],
.content-frosted-wrapper table [class*="bg-neutral"],
.content-frosted-wrapper table [class*="bg-white"],
.content-frosted-wrapper table [class*="bg-gray"],
.content-frosted-wrapper table [class*="bg-slate"] {
  background: unset !important;
  background-color: unset !important;
  background-image: unset !important;
}

html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-"],
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-neutral"],
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-white"],
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-gray"],
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-slate"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-neutral"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-white"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-gray"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th)[class*="bg-slate"] {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
}

/* Override max-width classes - GLOBAL */
.content-frosted-wrapper .max-w-prose,
.content-frosted-wrapper .max-w-7xl,
.content-frosted-wrapper .max-w-full,
.content-frosted-wrapper .max-w-fit,
.content-frosted-wrapper .max-w-2xs,
.content-frosted-wrapper .max-w-xs {
  max-width: none !important;
  width: auto !important;
}
/* Ensure article titles are visible - GLOBAL */
.content-frosted-wrapper article h2,
.content-frosted-wrapper article h2 a,
.content-frosted-wrapper article header h2,
.content-frosted-wrapper article header h2 a,
.content-frosted-wrapper article header a h2 {
  color: #1a1a1a !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
  font-size: 1.25rem !important;
  font-weight: 700 !important;
  margin-top: 0 !important;
  margin-bottom: 0.5rem !important;
  position: relative !important;
  z-index: 10 !important;
  line-height: 1.5 !important;
}

.dark .content-frosted-wrapper article h2,
.dark .content-frosted-wrapper article h2 a,
.dark .content-frosted-wrapper article header h2,
.dark .content-frosted-wrapper article header h2 a,
.dark .content-frosted-wrapper article header a h2 {
  color: #f0f0f0 !important;
}

/* Ensure article title links are clickable */
.content-frosted-wrapper article header a {
  position: relative !important;
  z-index: 10 !important;
  display: block !important;
  color: #1a1a1a !important;
  text-decoration: none !important;
  cursor: pointer !important;
  pointer-events: auto !important;
}

.dark .content-frosted-wrapper article header a {
  color: #f0f0f0 !important;
}

.content-frosted-wrapper article header a:hover {
  color: #3b82f6 !important;
  text-decoration: underline !important;
}

.dark .content-frosted-wrapper article header a:hover {
  color: #60a5fa !important;
}

.content-frosted-wrapper article header a::before {
  display: none !important;
}

/* Override any dark:text-neutral classes that might hide text - use attribute selector */
.content-frosted-wrapper article header a[class*="dark:text-neutral-100"],
.content-frosted-wrapper article header a[class*="dark:text-neutral"] {
  color: #1a1a1a !important;
}

.dark .content-frosted-wrapper article header a[class*="dark:text-neutral-100"],
.dark .content-frosted-wrapper article header a[class*="dark:text-neutral"] {
  color: #f0f0f0 !important;
}

/* Force override all text color classes on article title links */
.content-frosted-wrapper article header a,
.content-frosted-wrapper article header a *,
.content-frosted-wrapper article header a h2,
.content-frosted-wrapper article header a h2 * {
  color: #1a1a1a !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
}

.dark .content-frosted-wrapper article header a,
.dark .content-frosted-wrapper article header a *,
.dark .content-frosted-wrapper article header a h2,
.dark .content-frosted-wrapper article header a h2 * {
  color: #f0f0f0 !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
}

/* Override all Tailwind text color utilities that might hide text */
.content-frosted-wrapper article header a[class*="text-"],
.content-frosted-wrapper article header a h2[class*="text-"],
.content-frosted-wrapper article header a[class*="dark:text-"],
.content-frosted-wrapper article header a h2[class*="dark:text-"] {
  color: #1a1a1a !important;
}

.dark .content-frosted-wrapper article header a[class*="text-"],
.dark .content-frosted-wrapper article header a h2[class*="text-"],
.dark .content-frosted-wrapper article header a[class*="dark:text-"],
.dark .content-frosted-wrapper article header a h2[class*="dark:text-"] {
  color: #f0f0f0 !important;
}

/* Force show all text in article headers */
.content-frosted-wrapper article header,
.content-frosted-wrapper article header *,
.content-frosted-wrapper article header a,
.content-frosted-wrapper article header a *,
.content-frosted-wrapper article header a h2,
.content-frosted-wrapper article header a h2 * {
  color: #1a1a1a !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
  pointer-events: auto !important;
  order: -1 !important;
}

/* Ensure header is at the top of the article content */
.content-frosted-wrapper article > div > header {
  order: -1 !important;
  display: block !important;
  position: relative !important;
  z-index: 10 !important;
  margin-top: 0 !important;
  margin-bottom: 0.5rem !important;
}

/* Ensure article content div displays header first */
.content-frosted-wrapper article > div.p-4 {
  display: flex !important;
  flex-direction: column !important;
}

.content-frosted-wrapper article > div.p-4 > header {
  order: 0 !important;
  flex-shrink: 0 !important;
  margin-bottom: 0.5rem !important;
}

.content-frosted-wrapper article > div.p-4 > div.text-sm {
  order: 1 !important;
  flex-shrink: 0 !important;
}

.content-frosted-wrapper article > div.p-4 > div.prose {
  order: 2 !important;
  flex-shrink: 0 !important;
}

/* Ensure header is always visible at the top */
.content-frosted-wrapper article > div.p-4 > header {
  position: relative !important;
  z-index: 10 !important;
  display: block !important;
  width: 100% !important;
  visibility: visible !important;
  opacity: 1 !important;
  height: auto !important;
  min-height: auto !important;
  overflow: visible !important;
}

/* Override any rules that might hide article headers */
.content-frosted-wrapper article header,
article header {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  height: auto !important;
  min-height: auto !important;
  overflow: visible !important;
}

.dark .content-frosted-wrapper article header,
.dark .content-frosted-wrapper article header *,
.dark .content-frosted-wrapper article header a,
.dark .content-frosted-wrapper article header a *,
.dark .content-frosted-wrapper article header a h2,
.dark .content-frosted-wrapper article header a h2 * {
  color: #f0f0f0 !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
  pointer-events: auto !important;
}

/* Ensure no element is blocking the link */
.content-frosted-wrapper article header a * {
  pointer-events: none !important;
}

.content-frosted-wrapper article header a {
  pointer-events: auto !important;
}

/* Override ALL possible text color classes - highest priority */
.content-frosted-wrapper article header a[class*="text-neutral"],
.content-frosted-wrapper article header a h2[class*="text-neutral"],
.content-frosted-wrapper article header a[class*="text-800"],
.content-frosted-wrapper article header a h2[class*="text-800"],
.content-frosted-wrapper article header a[class*="text-100"],
.content-frosted-wrapper article header a h2[class*="text-100"] {
  color: #1a1a1a !important;
}

.dark .content-frosted-wrapper article header a[class*="text-neutral"],
.dark .content-frosted-wrapper article header a h2[class*="text-neutral"],
.dark .content-frosted-wrapper article header a[class*="text-800"],
.dark .content-frosted-wrapper article header a h2[class*="text-800"],
.dark .content-frosted-wrapper article header a[class*="text-100"],
.dark .content-frosted-wrapper article header a h2[class*="text-100"] {
  color: #f0f0f0 !important;
}

.content-frosted-wrapper article h2 a:hover {
  color: #3b82f6 !important;
  text-decoration: underline !important;
}

.dark .content-frosted-wrapper article h2 a:hover {
  color: #60a5fa !important;
}

/* Force remove all backgrounds with highest specificity */
/* 排除表格元素，让表格样式可以正常显示 */
html body main#main-content .content-frosted-wrapper *:not(table):not(thead):not(tbody):not(tr):not(td):not(th),
html body main#main-content .content-frosted-wrapper *:not(table):not(thead):not(tbody):not(tr):not(td):not(th)::before,
html body main#main-content .content-frosted-wrapper *:not(table):not(thead):not(tbody):not(tr):not(td):not(th)::after {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  box-shadow: none !important;
  border: none !important;
  border-radius: 0 !important;
  border-color: transparent !important;
}

/* 确保表格元素不受上面的规则影响 */
html body main#main-content .content-frosted-wrapper table,
html body main#main-content .content-frosted-wrapper table *,
html body main#main-content .content-frosted-wrapper thead,
html body main#main-content .content-frosted-wrapper thead *,
html body main#main-content .content-frosted-wrapper tbody,
html body main#main-content .content-frosted-wrapper tbody *,
html body main#main-content .content-frosted-wrapper tr,
html body main#main-content .content-frosted-wrapper tr *,
html body main#main-content .content-frosted-wrapper td,
html body main#main-content .content-frosted-wrapper th {
  background: unset !important;
  background-color: unset !important;
  background-image: unset !important;
  backdrop-filter: unset !important;
  -webkit-backdrop-filter: unset !important;
  box-shadow: unset !important;
  border: unset !important;
  border-radius: unset !important;
  border-color: unset !important;
}

/* Allow styling for article metadata and author sections - Use unset to allow custom styles */
html body main#main-content .content-frosted-wrapper #single_header > div:first-of-type,
html body main#main-content .content-frosted-wrapper #single_header > div:first-of-type *,
html body main#main-content .content-frosted-wrapper #single_header .author,
html body main#main-content .content-frosted-wrapper #single_header .author *,
html body main#main-content .content-frosted-wrapper #single_header .author img,
html body main#main-content .content-frosted-wrapper #single_header .flex.flex-row.flex-wrap.items-center a.relative,
html body main#main-content .content-frosted-wrapper #single_header .flex.flex-row.flex-wrap.items-center a.relative *,
html body main#main-content .content-frosted-wrapper #single_header .flex.flex-row.flex-wrap.items-center a.relative span {
  background: unset !important;
  background-color: unset !important;
  background-image: unset !important;
  backdrop-filter: unset !important;
  -webkit-backdrop-filter: unset !important;
  box-shadow: unset !important;
  border: unset !important;
  border-radius: unset !important;
  border-color: unset !important;
  border-width: unset !important;
  border-style: unset !important;
}
</style>

<script>
// Force apply styles after page load
(function() {
  function forceRemoveBackgrounds() {
    const wrapper = document.querySelector('.content-frosted-wrapper');
    if (!wrapper) return;
    
    // Get all elements inside wrapper, but exclude table elements
    const allElements = wrapper.querySelectorAll('*');
    
    // Table-related tag names to exclude
    const tableTags = ['TABLE', 'THEAD', 'TBODY', 'TFOOT', 'TR', 'TD', 'TH'];
    
    allElements.forEach(function(el) {
      // Skip table elements - let them use their custom styles
      if (tableTags.includes(el.tagName)) {
        return;
      }
      
      // Also skip if element is inside a table
      if (el.closest('table')) {
        return;
      }
      
      // Force remove all backgrounds
      el.style.setProperty('background', 'transparent', 'important');
      el.style.setProperty('background-color', 'transparent', 'important');
      el.style.setProperty('background-image', 'none', 'important');
      el.style.setProperty('backdrop-filter', 'none', 'important');
      el.style.setProperty('-webkit-backdrop-filter', 'none', 'important');
      el.style.setProperty('box-shadow', 'none', 'important');
      el.style.setProperty('border', 'none', 'important');
      el.style.setProperty('border-radius', '0', 'important');
      el.style.setProperty('border-color', 'transparent', 'important');
      
      // Remove bg- classes
      const classes = el.className;
      if (classes && typeof classes === 'string') {
        const bgClasses = classes.split(' ').filter(function(c) {
          return c.startsWith('bg-') || c.startsWith('bg-neutral') || c.startsWith('bg-white') || c.startsWith('bg-gray') || c.startsWith('bg-slate');
        });
        bgClasses.forEach(function(c) {
          el.classList.remove(c);
        });
      }
    });
  }
  
  // Run immediately
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(forceRemoveBackgrounds, 100);
    });
  } else {
    setTimeout(forceRemoveBackgrounds, 100);
  }
  
  // Also run after a delay to catch dynamically loaded content
  setTimeout(forceRemoveBackgrounds, 500);
  setTimeout(forceRemoveBackgrounds, 1000);
})();
</script>

<!-- Global Background -->
<div class="global-background">
  {{ $defaultBgPath := "/images/background.png" }}
  {{ if .Site.BaseURL }}
    {{ $baseURL := strings.TrimSuffix "/" .Site.BaseURL }}
    {{ $defaultBgPath = printf "%s/images/background.png" $baseURL }}
  {{ end }}
  <img
    id="global-background-image"
    src="{{ $defaultBgPath }}"
    alt="Background"
    style="width: 100%; height: 100%; object-fit: cover; display: block;"
    onerror="console.error('Background image failed to load:', this.src); this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.display='block';">
</div>

<!-- Background Image Configuration -->
<script>
  console.log('=== 背景切换脚本开始执行 ===');
  
  // 立即设置主题切换监听（必须在其他代码之前）
  (function() {
    console.log('开始设置主题切换监听器...');
    
    function handleThemeClick(event) {
      console.log('捕获到主题切换按钮点击！', event.target, event.currentTarget);
      
      // 阻止默认行为
      event.preventDefault();
      event.stopPropagation();
      event.stopImmediatePropagation();
      
      // 获取当前主题状态
      const isCurrentlyDark = document.documentElement.classList.contains('dark');
      const targetTheme = isCurrentlyDark ? '亮色' : '暗色';
      const targetFolder = isCurrentlyDark ? 'day' : 'night';
      
      // 弹出确认框
      const confirmed = confirm('检测到主题切换！\n\n当前主题：' + (isCurrentlyDark ? '暗色' : '亮色') + 
                                '\n将切换到：' + targetTheme + 
                                '\n背景图将切换到：' + targetFolder + ' 文件夹\n\n是否确认切换？');
      
      if (confirmed) {
        // 用户确认后，手动切换主题
        document.documentElement.classList.toggle('dark');
        const newTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        localStorage.setItem('appearance', newTheme);
        
        // 切换背景图
        setTimeout(function() {
          if (typeof loadBackgroundImage === 'function') {
            loadBackgroundImage();
          }
          alert('主题已切换到：' + (newTheme === 'dark' ? '暗色' : '亮色') + '\n背景图已切换到：' + (newTheme === 'dark' ? 'night' : 'day') + ' 文件夹');
        }, 100);
      }
      
      return false;
    }
    
    // 使用事件委托，在捕获阶段监听所有点击
    document.addEventListener('click', function(event) {
      const target = event.target;
      // 检查是否点击了主题切换按钮或其子元素
      const button = target.closest('#appearance-switcher, #appearance-switcher-mobile, #fixed-appearance-switcher');
      if (button) {
        console.log('找到主题切换按钮:', button.id, button);
        handleThemeClick(event);
      }
    }, true); // 使用捕获阶段，确保在其他监听器之前执行
    
    console.log('事件委托监听器已设置');
  })();
  
  (function() {
    // Day images list
    const dayImages = [
      "1017f4097097d999dcdbf7ef79026e11.png",
      "140526d3500dd876f50ece7bfb72ba54.png",
      "368c9692c58f2b8b277f982ec4cbe6f2.png",
      "3ecac5dee49fabfa42465e7fd59b1b57.png",
      "504cebc0c21eaa2834b489302c57b8c0.png",
      "55c2a20739e6fc330daa249451eb2840.png",
      "632b67e4e8aeb588a3ff2b0585bd3a8b.png",
      "7aac5c282795ad454e6506caa2b06cc4.png",
      "8e5cd9e57e0530e476d958b840dc8607.png",
      "b713e0bc84a5bd6d442d3ed1e0614d42.png",
      "d431c141a75bbf8fe24ea34f5f990b02.png",
      "da3dada4b928700a614d79ce9d80f9a4.png",
      "e141f4825fcb18929ea76a220b95b451.png",
      "e2f5c14ccb7050a1bedad92ecd551bfd.png",
      "e3afbe67acdaf11f1766f65a3b3265e2.png",
      "f4b68290e172eb46d2d0659b042fd40c.png",
      "f6e06e41bf06e1f0595a0fceee93e36c.png",
      "f96dc4c92b6a1c451a1bb60960e04e49.png"
    ];
    
    // Night images list
    const nightImages = [
      "420ef354b7e5c46e67ca430592510ee8.png",
      "4389ff517b87f2fcdde61e930ed477c2.png",
      "5b4df5eff935e82ac52f35fd50724c04.png"
    ];
    
    // Default background
    const defaultBg = "{{ $defaultBgPath }}";
    
    // Base URL for images
    const baseURL = "{{ .Site.BaseURL }}";
    const imagesBasePath = baseURL ? (baseURL.endsWith('/') ? baseURL.slice(0, -1) : baseURL) + "/images" : "/images";
    
    // Determine if it's day or night based on current time
    function isDayTime() {
      const hour = new Date().getHours();
      // Day: 6:00 - 18:00 (6 AM - 6 PM)
      // Night: 18:00 - 6:00 (6 PM - 6 AM)
      return hour >= 6 && hour < 18;
    }
    
    // Determine if should use day or night images
    // Priority: manual theme toggle > time-based
    function shouldUseDayImages() {
      // Check if user has manually set a theme preference
      const userPreference = localStorage.getItem("appearance");
      const isDarkMode = document.documentElement.classList.contains("dark");
      
      // If user has manually set dark mode, use night images
      // If user has manually set light mode, use day images
      // Otherwise, use time-based logic
      if (userPreference === "dark") {
        return false; // Use night images
      } else if (userPreference === "light") {
        return true; // Use day images
      } else {
        // No manual preference, use time-based logic
        return isDayTime();
      }
    }
    
    // Get random image from array
    function getRandomImage(images) {
      if (images.length === 0) return null;
      const randomIndex = Math.floor(Math.random() * images.length);
      return images[randomIndex];
    }
    
    // Load background image
    function loadBackgroundImage() {
      const bgImage = document.getElementById('global-background-image');
      if (!bgImage) return;
      
      const useDayImages = shouldUseDayImages();
      const imageFolder = useDayImages ? 'day' : 'night';
      const imageList = useDayImages ? dayImages : nightImages;
      
      // Get random image
      const randomImage = getRandomImage(imageList);
      let imagePath = defaultBg; // Fallback to default
      
      if (randomImage) {
        imagePath = imagesBasePath + "/" + imageFolder + "/" + randomImage;
      }
      
      // Create new image to preload
      const img = new Image();
      img.onload = function() {
        // Image loaded successfully, update background
        bgImage.src = imagePath;
        bgImage.style.display = 'block';
      };
      img.onerror = function() {
        // Image failed to load, try default
        console.warn('Failed to load image:', imagePath, 'Using default background');
        bgImage.src = defaultBg;
        bgImage.style.display = 'block';
        
        // If default also fails, use gradient
        bgImage.onerror = function() {
          bgImage.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
          bgImage.style.display = 'block';
        };
      };
      
      // Start loading
      img.src = imagePath;
    }
    
    // Watch for theme changes - 使用 MutationObserver 监听主题变化
    function watchThemeChanges() {
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            setTimeout(function() {
              loadBackgroundImage();
            }, 100);
          }
        });
      });
      
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });
    }
    
    // Initialize background and watch for changes
    function initBackground() {
      // Load background when page loads
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          loadBackgroundImage();
          watchThemeChanges();
        });
      } else {
        loadBackgroundImage();
        watchThemeChanges();
      }
    }
    
    initBackground();
  })();
</script>

