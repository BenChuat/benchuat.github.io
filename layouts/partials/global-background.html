{{ $disableImageOptimization := .Site.Params.disableImageOptimization | default false }}
<style>
/* Global Background Styles - Applied to all pages */
.global-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -10;
  overflow: hidden;
  pointer-events: none;
}

.global-background img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Ensure body and main content are transparent to show background */
body {
  background: transparent !important;
  max-width: none !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

main#main-content {
  background: transparent !important;
  max-width: none !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

/* Unified frosted glass container - 80% width - GLOBAL STYLES */
.content-frosted-wrapper {
  width: 80% !important;
  max-width: none !important;
  margin: 2rem auto !important;
  background: rgba(255, 255, 255, 0.85) !important;
  backdrop-filter: blur(20px) !important;
  -webkit-backdrop-filter: blur(20px) !important;
  border-radius: 16px !important;
  padding: 3rem !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
  border: 1px solid rgba(255, 255, 255, 0.3) !important;
  position: relative;
  z-index: 1;
}

.dark .content-frosted-wrapper {
  background: rgba(30, 30, 30, 0.85) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

/* COMPLETELY REMOVE all backgrounds from ALL internal elements - GLOBAL - HIGHEST PRIORITY */
html body main#main-content .content-frosted-wrapper *,
html body main#main-content .content-frosted-wrapper *::before,
html body main#main-content .content-frosted-wrapper *::after,
.content-frosted-wrapper *,
.content-frosted-wrapper *::before,
.content-frosted-wrapper *::after {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  box-shadow: none !important;
  border: none !important;
  border-radius: 0 !important;
  border-color: transparent !important;
}

/* Override all Tailwind bg- classes - GLOBAL - HIGHEST PRIORITY */
html body main#main-content .content-frosted-wrapper [class*="bg-"],
html body main#main-content .content-frosted-wrapper [class*="bg-neutral"],
html body main#main-content .content-frosted-wrapper [class*="bg-white"],
html body main#main-content .content-frosted-wrapper [class*="bg-gray"],
html body main#main-content .content-frosted-wrapper [class*="bg-slate"],
.content-frosted-wrapper [class*="bg-"],
.content-frosted-wrapper [class*="bg-neutral"],
.content-frosted-wrapper [class*="bg-white"],
.content-frosted-wrapper [class*="bg-gray"],
.content-frosted-wrapper [class*="bg-slate"] {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
}

/* Override max-width classes - GLOBAL */
.content-frosted-wrapper .max-w-prose,
.content-frosted-wrapper .max-w-7xl,
.content-frosted-wrapper .max-w-full,
.content-frosted-wrapper .max-w-fit,
.content-frosted-wrapper .max-w-2xs,
.content-frosted-wrapper .max-w-xs {
  max-width: none !important;
  width: auto !important;
}

/* Force remove all backgrounds with highest specificity */
html body main#main-content .content-frosted-wrapper *,
html body main#main-content .content-frosted-wrapper *::before,
html body main#main-content .content-frosted-wrapper *::after {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  box-shadow: none !important;
  border: none !important;
  border-radius: 0 !important;
  border-color: transparent !important;
}
</style>

<script>
// Force apply styles after page load
(function() {
  function forceRemoveBackgrounds() {
    const wrapper = document.querySelector('.content-frosted-wrapper');
    if (!wrapper) return;
    
    // Get all elements inside wrapper
    const allElements = wrapper.querySelectorAll('*');
    
    allElements.forEach(function(el) {
      // Force remove all backgrounds
      el.style.setProperty('background', 'transparent', 'important');
      el.style.setProperty('background-color', 'transparent', 'important');
      el.style.setProperty('background-image', 'none', 'important');
      el.style.setProperty('backdrop-filter', 'none', 'important');
      el.style.setProperty('-webkit-backdrop-filter', 'none', 'important');
      el.style.setProperty('box-shadow', 'none', 'important');
      el.style.setProperty('border', 'none', 'important');
      el.style.setProperty('border-radius', '0', 'important');
      el.style.setProperty('border-color', 'transparent', 'important');
      
      // Remove bg- classes
      const classes = el.className;
      if (classes && typeof classes === 'string') {
        const bgClasses = classes.split(' ').filter(function(c) {
          return c.startsWith('bg-') || c.startsWith('bg-neutral') || c.startsWith('bg-white') || c.startsWith('bg-gray') || c.startsWith('bg-slate');
        });
        bgClasses.forEach(function(c) {
          el.classList.remove(c);
        });
      }
    });
  }
  
  // Run immediately
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(forceRemoveBackgrounds, 100);
    });
  } else {
    setTimeout(forceRemoveBackgrounds, 100);
  }
  
  // Also run after a delay to catch dynamically loaded content
  setTimeout(forceRemoveBackgrounds, 500);
  setTimeout(forceRemoveBackgrounds, 1000);
})();
</script>

<!-- Global Background -->
<div class="global-background">
  {{ $defaultBgPath := "/images/background.png" }}
  {{ if .Site.BaseURL }}
    {{ $baseURL := strings.TrimSuffix "/" .Site.BaseURL }}
    {{ $defaultBgPath = printf "%s/images/background.png" $baseURL }}
  {{ end }}
  <img
    id="global-background-image"
    src="{{ $defaultBgPath }}"
    alt="Background"
    style="width: 100%; height: 100%; object-fit: cover; display: block;"
    onerror="console.error('Background image failed to load:', this.src); this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.display='block';">
</div>

<!-- Background Image Configuration -->
<script>
  (function() {
    // Day images list
    const dayImages = [
      "1017f4097097d999dcdbf7ef79026e11.png",
      "140526d3500dd876f50ece7bfb72ba54.png",
      "368c9692c58f2b8b277f982ec4cbe6f2.png",
      "3ecac5dee49fabfa42465e7fd59b1b57.png",
      "504cebc0c21eaa2834b489302c57b8c0.png",
      "55c2a20739e6fc330daa249451eb2840.png",
      "632b67e4e8aeb588a3ff2b0585bd3a8b.png",
      "7aac5c282795ad454e6506caa2b06cc4.png",
      "8e5cd9e57e0530e476d958b840dc8607.png",
      "b713e0bc84a5bd6d442d3ed1e0614d42.png",
      "d431c141a75bbf8fe24ea34f5f990b02.png",
      "da3dada4b928700a614d79ce9d80f9a4.png",
      "e141f4825fcb18929ea76a220b95b451.png",
      "e2f5c14ccb7050a1bedad92ecd551bfd.png",
      "e3afbe67acdaf11f1766f65a3b3265e2.png",
      "f4b68290e172eb46d2d0659b042fd40c.png",
      "f6e06e41bf06e1f0595a0fceee93e36c.png",
      "f96dc4c92b6a1c451a1bb60960e04e49.png"
    ];
    
    // Night images list
    const nightImages = [
      "420ef354b7e5c46e67ca430592510ee8.png",
      "4389ff517b87f2fcdde61e930ed477c2.png",
      "5b4df5eff935e82ac52f35fd50724c04.png"
    ];
    
    // Default background
    const defaultBg = "{{ $defaultBgPath }}";
    
    // Base URL for images
    const baseURL = "{{ .Site.BaseURL }}";
    const imagesBasePath = baseURL ? (baseURL.endsWith('/') ? baseURL.slice(0, -1) : baseURL) + "/images" : "/images";
    
    // Determine if it's day or night based on current time
    function isDayTime() {
      const hour = new Date().getHours();
      // Day: 6:00 - 18:00 (6 AM - 6 PM)
      // Night: 18:00 - 6:00 (6 PM - 6 AM)
      return hour >= 6 && hour < 18;
    }
    
    // Get random image from array
    function getRandomImage(images) {
      if (images.length === 0) return null;
      const randomIndex = Math.floor(Math.random() * images.length);
      return images[randomIndex];
    }
    
    // Load background image
    function loadBackgroundImage() {
      const bgImage = document.getElementById('global-background-image');
      if (!bgImage) return;
      
      const isDay = isDayTime();
      const imageFolder = isDay ? 'day' : 'night';
      const imageList = isDay ? dayImages : nightImages;
      
      // Get random image
      const randomImage = getRandomImage(imageList);
      let imagePath = defaultBg; // Fallback to default
      
      if (randomImage) {
        imagePath = imagesBasePath + "/" + imageFolder + "/" + randomImage;
      }
      
      // Create new image to preload
      const img = new Image();
      img.onload = function() {
        // Image loaded successfully, update background
        bgImage.src = imagePath;
        bgImage.style.display = 'block';
      };
      img.onerror = function() {
        // Image failed to load, try default
        console.warn('Failed to load image:', imagePath, 'Using default background');
        bgImage.src = defaultBg;
        bgImage.style.display = 'block';
        
        // If default also fails, use gradient
        bgImage.onerror = function() {
          bgImage.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
          bgImage.style.display = 'block';
        };
      };
      
      // Start loading
      img.src = imagePath;
    }
    
    // Load background when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadBackgroundImage);
    } else {
      loadBackgroundImage();
    }
  })();
</script>

