{{ $disableImageOptimization := .Site.Params.disableImageOptimization | default false }}
<style>
/* Global Background Styles - Applied to all pages */
.global-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -10;
  overflow: hidden;
  pointer-events: none;
}

.global-background img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Ensure body and main content are transparent to show background */
body {
  background: transparent !important;
  max-width: none !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

main#main-content {
  background: transparent !important;
  max-width: none !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

/* Unified frosted glass container - 80% width - GLOBAL STYLES */
.content-frosted-wrapper {
  width: 80% !important;
  max-width: none !important;
  margin: 2rem auto !important;
  background: rgba(255, 255, 255, 0.85) !important;
  backdrop-filter: blur(20px) !important;
  -webkit-backdrop-filter: blur(20px) !important;
  border-radius: 16px !important;
  padding: 3rem !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
  border: 1px solid rgba(255, 255, 255, 0.3) !important;
  position: relative;
  z-index: 1;
}

.dark .content-frosted-wrapper {
  background: rgba(30, 30, 30, 0.85) !important;
  border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

/* COMPLETELY REMOVE all backgrounds from ALL internal elements - GLOBAL - HIGHEST PRIORITY */
/* 注意：表格元素和代码块在后面的规则中单独处理 */
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label),
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)::before,
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)::after,
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label),
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)::before,
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)::after {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  box-shadow: none !important;
  border: none !important;
  border-radius: 0 !important;
  border-color: transparent !important;
}

/* 为包含表格的容器添加横向滚动，防止表格超出容器 */
html body main#main-content .content-frosted-wrapper .prose:has(table),
html body main#main-content .content-frosted-wrapper .article-content:has(table) {
  overflow-x: auto !important;
  overflow-y: visible !important;
  -webkit-overflow-scrolling: touch !important;
}

/* 表格元素例外 - 允许表格样式正常显示，并应用自定义样式 */
html body main#main-content .content-frosted-wrapper .prose table,
html body main#main-content .content-frosted-wrapper .article-content table,
html body main#main-content .content-frosted-wrapper .article-content .prose table,
html body main#main-content .content-frosted-wrapper article .prose table,
html body main#main-content .content-frosted-wrapper article .article-content table {
  display: table !important;
  background: rgba(255, 255, 255, 0.5) !important;
  background-color: rgba(255, 255, 255, 0.5) !important;
  background-image: none !important;
  width: 100% !important;
  max-width: 100% !important;
  min-width: min-content !important;
  border-collapse: collapse !important;
  margin: 1.5rem 0 !important;
  table-layout: auto !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
  font-size: 1.125rem !important;
  border: 1px solid rgba(255, 255, 255, 0.4) !important;
  border-radius: 12px !important;
  overflow: hidden !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
  backdrop-filter: blur(10px) !important;
  -webkit-backdrop-filter: blur(10px) !important;
  box-sizing: border-box !important;
  table-layout: auto !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose table,
.dark html body main#main-content .content-frosted-wrapper .article-content table,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose table,
.dark html body main#main-content .content-frosted-wrapper article .prose table,
.dark html body main#main-content .content-frosted-wrapper article .article-content table {
  border-color: rgba(255, 255, 255, 0.08) !important;
  background: rgba(22, 22, 22, 0.7) !important;
  background-color: rgba(22, 22, 22, 0.7) !important;
}

html body main#main-content .content-frosted-wrapper .prose thead,
html body main#main-content .content-frosted-wrapper .article-content thead,
html body main#main-content .content-frosted-wrapper .article-content .prose thead,
html body main#main-content .content-frosted-wrapper article .prose thead,
html body main#main-content .content-frosted-wrapper article .article-content thead {
  background: rgba(255, 255, 255, 0.7) !important;
  background-color: rgba(255, 255, 255, 0.7) !important;
  background-image: none !important;
  display: table-header-group !important;
  backdrop-filter: blur(10px) !important;
  -webkit-backdrop-filter: blur(10px) !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose thead,
.dark html body main#main-content .content-frosted-wrapper .article-content thead,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose thead,
.dark html body main#main-content .content-frosted-wrapper article .prose thead,
.dark html body main#main-content .content-frosted-wrapper article .article-content thead {
  background: rgba(40, 40, 40, 0.9) !important;
  background-color: rgba(40, 40, 40, 0.9) !important;
}

html body main#main-content .content-frosted-wrapper .prose thead th,
html body main#main-content .content-frosted-wrapper .article-content thead th,
html body main#main-content .content-frosted-wrapper .article-content .prose thead th,
html body main#main-content .content-frosted-wrapper article .prose thead th,
html body main#main-content .content-frosted-wrapper article .article-content thead th {
  background: rgba(255, 255, 255, 0.7) !important;
  background-color: rgba(255, 255, 255, 0.7) !important;
  background-image: none !important;
  padding: 0.875rem 1rem !important;
  text-align: left !important;
  font-weight: 600 !important;
  color: #1a1a1a !important;
  border: none !important;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
  border-right: 1px solid rgba(0, 0, 0, 0.08) !important;
  border-radius: 0 !important;
  font-size: 1.125rem !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose thead th,
.dark html body main#main-content .content-frosted-wrapper .article-content thead th,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose thead th,
.dark html body main#main-content .content-frosted-wrapper article .prose thead th,
.dark html body main#main-content .content-frosted-wrapper article .article-content thead th {
  background: rgba(40, 40, 40, 0.9) !important;
  background-color: rgba(40, 40, 40, 0.9) !important;
  color: #ffffff !important;
  border-bottom-color: rgba(255, 255, 255, 0.1) !important;
  border-right-color: rgba(255, 255, 255, 0.08) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody,
html body main#main-content .content-frosted-wrapper article .prose tbody {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody tr,
html body main#main-content .content-frosted-wrapper .article-content tbody tr,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr,
html body main#main-content .content-frosted-wrapper article .prose tbody tr,
html body main#main-content .content-frosted-wrapper article .article-content tbody tr {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  border: none !important;
  border-bottom: 1px solid rgba(0, 0, 0, 0.08) !important;
  border-radius: 0 !important;
  transition: background-color 0.2s ease !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody tr,
.dark html body main#main-content .content-frosted-wrapper .article-content tbody tr,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr,
.dark html body main#main-content .content-frosted-wrapper article .prose tbody tr,
.dark html body main#main-content .content-frosted-wrapper article .article-content tbody tr {
  border-bottom-color: rgba(255, 255, 255, 0.08) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(even),
html body main#main-content .content-frosted-wrapper .article-content tbody tr:nth-child(even),
html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(even),
html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(even),
html body main#main-content .content-frosted-wrapper article .article-content tbody tr:nth-child(even) {
  background: rgba(255, 255, 255, 0.3) !important;
  background-color: rgba(255, 255, 255, 0.3) !important;
  background-image: none !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(even),
.dark html body main#main-content .content-frosted-wrapper .article-content tbody tr:nth-child(even),
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(even),
.dark html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(even),
.dark html body main#main-content .content-frosted-wrapper article .article-content tbody tr:nth-child(even) {
  background: rgba(35, 35, 35, 0.7) !important;
  background-color: rgba(35, 35, 35, 0.7) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(odd),
html body main#main-content .content-frosted-wrapper .article-content tbody tr:nth-child(odd),
html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(odd),
html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(odd),
html body main#main-content .content-frosted-wrapper article .article-content tbody tr:nth-child(odd) {
  background: rgba(255, 255, 255, 0.2) !important;
  background-color: rgba(255, 255, 255, 0.2) !important;
  background-image: none !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(odd),
.dark html body main#main-content .content-frosted-wrapper .article-content tbody tr:nth-child(odd),
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(odd),
.dark html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(odd),
.dark html body main#main-content .content-frosted-wrapper article .article-content tbody tr:nth-child(odd) {
  background: rgba(30, 30, 30, 0.7) !important;
  background-color: rgba(30, 30, 30, 0.7) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody tr:hover,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:hover,
html body main#main-content .content-frosted-wrapper article .prose tbody tr:hover {
  background: rgba(255, 255, 255, 0.5) !important;
  background-color: rgba(255, 255, 255, 0.5) !important;
  background-image: none !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody tr:hover,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:hover,
.dark html body main#main-content .content-frosted-wrapper article .prose tbody tr:hover {
  background: rgba(32, 32, 32, 0.6) !important;
  background-color: rgba(32, 32, 32, 0.6) !important;
}

html body main#main-content .content-frosted-wrapper .prose tbody td,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody td,
html body main#main-content .content-frosted-wrapper article .prose tbody td {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  padding: 0.875rem 1rem !important;
  border: none !important;
  border-right: 1px solid rgba(0, 0, 0, 0.08) !important;
  border-radius: 0 !important;
  font-size: 1.125rem !important;
  line-height: 1.6 !important;
}

.dark html body main#main-content .content-frosted-wrapper .prose tbody td,
.dark html body main#main-content .content-frosted-wrapper .article-content tbody td,
.dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody td,
.dark html body main#main-content .content-frosted-wrapper article .prose tbody td,
.dark html body main#main-content .content-frosted-wrapper article .article-content tbody td {
  border-right-color: rgba(255, 255, 255, 0.08) !important;
  color: #ffffff !important;
}

html body main#main-content .content-frosted-wrapper .prose thead th:last-child,
html body main#main-content .content-frosted-wrapper .article-content .prose thead th:last-child,
html body main#main-content .content-frosted-wrapper article .prose thead th:last-child,
html body main#main-content .content-frosted-wrapper .prose tbody td:last-child,
html body main#main-content .content-frosted-wrapper .article-content .prose tbody td:last-child,
html body main#main-content .content-frosted-wrapper article .prose tbody td:last-child {
  border-right: none !important;
  border-right-width: 0 !important;
  border-right-style: none !important;
  padding-right: 1rem !important;
}

/* 代码块元素例外 - 允许代码块样式正常显示 */
/* 注意：具体样式在 single.html 中定义，这里只排除全局规则 */
html body main#main-content .content-frosted-wrapper .prose .chroma,
html body main#main-content .content-frosted-wrapper .prose .highlight,
html body main#main-content .content-frosted-wrapper .prose pre,
html body main#main-content .content-frosted-wrapper .prose pre code,
html body main#main-content .content-frosted-wrapper .prose .code-lang-label {
  /* 不设置 background: initial，让 single.html 中的样式生效 */
}

/* 暗色模式代码块背景 - 直接在这里设置，确保不被覆盖 */
html body.dark main#main-content .content-frosted-wrapper .prose .chroma,
html body.dark main#main-content .content-frosted-wrapper .prose .highlight,
html body.dark main#main-content .content-frosted-wrapper .prose pre[class*="language-"],
html body.dark main#main-content .content-frosted-wrapper .prose pre,
html body.dark main#main-content .content-frosted-wrapper .prose .chroma *,
html body.dark main#main-content .content-frosted-wrapper .prose .highlight *,
html body.dark main#main-content .content-frosted-wrapper .prose pre *,
html body.dark main#main-content .content-frosted-wrapper .prose .chroma .lntd,
html body.dark main#main-content .content-frosted-wrapper .prose .chroma .lntd:first-child,
html body.dark main#main-content .content-frosted-wrapper .prose .chroma .lntd:last-child {
  background: #000000 !important;
  background-color: #000000 !important;
  background-image: none !important;
}



/* Override all Tailwind bg- classes - GLOBAL - HIGHEST PRIORITY */
/* 排除表格元素和代码块元素 */
html body main#main-content .content-frosted-wrapper table [class*="bg-"],
html body main#main-content .content-frosted-wrapper table [class*="bg-neutral"],
html body main#main-content .content-frosted-wrapper table [class*="bg-white"],
html body main#main-content .content-frosted-wrapper table [class*="bg-gray"],
html body main#main-content .content-frosted-wrapper table [class*="bg-slate"],
.content-frosted-wrapper table [class*="bg-"],
.content-frosted-wrapper table [class*="bg-neutral"],
.content-frosted-wrapper table [class*="bg-white"],
.content-frosted-wrapper table [class*="bg-gray"],
.content-frosted-wrapper table [class*="bg-slate"] {
  background: unset !important;
  background-color: unset !important;
  background-image: unset !important;
}

html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-"],
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-neutral"],
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-white"],
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-gray"],
html body main#main-content .content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-slate"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-neutral"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-white"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-gray"],
.content-frosted-wrapper *:not(table):not(table *):not(thead):not(thead *):not(tbody):not(tbody *):not(tr):not(tr *):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)[class*="bg-slate"] {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
}

/* Override max-width classes - GLOBAL */
.content-frosted-wrapper .max-w-prose,
.content-frosted-wrapper .max-w-7xl,
.content-frosted-wrapper .max-w-full,
.content-frosted-wrapper .max-w-fit,
.content-frosted-wrapper .max-w-2xs,
.content-frosted-wrapper .max-w-xs {
  max-width: none !important;
  width: auto !important;
}
/* Ensure article titles are visible - GLOBAL */
.content-frosted-wrapper article h2,
.content-frosted-wrapper article h2 a,
.content-frosted-wrapper article header h2,
.content-frosted-wrapper article header h2 a,
.content-frosted-wrapper article header a h2 {
  color: #1a1a1a !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
  font-size: 1.25rem !important;
  font-weight: 700 !important;
  margin-top: 0 !important;
  margin-bottom: 0.5rem !important;
  position: relative !important;
  z-index: 10 !important;
  line-height: 1.5 !important;
}

.dark .content-frosted-wrapper article h2,
.dark .content-frosted-wrapper article h2 a,
.dark .content-frosted-wrapper article header h2,
.dark .content-frosted-wrapper article header h2 a,
.dark .content-frosted-wrapper article header a h2 {
  color: #f0f0f0 !important;
}

/* Ensure article title links are clickable */
.content-frosted-wrapper article header a {
  position: relative !important;
  z-index: 10 !important;
  display: block !important;
  color: #1a1a1a !important;
  text-decoration: none !important;
  cursor: pointer !important;
  pointer-events: auto !important;
}

.dark .content-frosted-wrapper article header a {
  color: #f0f0f0 !important;
}

.content-frosted-wrapper article header a:hover {
  color: #3b82f6 !important;
  text-decoration: underline !important;
}

.dark .content-frosted-wrapper article header a:hover {
  color: #60a5fa !important;
}

.content-frosted-wrapper article header a::before {
  display: none !important;
}

/* Override any dark:text-neutral classes that might hide text - use attribute selector */
.content-frosted-wrapper article header a[class*="dark:text-neutral-100"],
.content-frosted-wrapper article header a[class*="dark:text-neutral"] {
  color: #1a1a1a !important;
}

.dark .content-frosted-wrapper article header a[class*="dark:text-neutral-100"],
.dark .content-frosted-wrapper article header a[class*="dark:text-neutral"] {
  color: #f0f0f0 !important;
}

/* Force override all text color classes on article title links */
.content-frosted-wrapper article header a,
.content-frosted-wrapper article header a *,
.content-frosted-wrapper article header a h2,
.content-frosted-wrapper article header a h2 * {
  color: #1a1a1a !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
}

.dark .content-frosted-wrapper article header a,
.dark .content-frosted-wrapper article header a *,
.dark .content-frosted-wrapper article header a h2,
.dark .content-frosted-wrapper article header a h2 * {
  color: #f0f0f0 !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
}

/* Override all Tailwind text color utilities that might hide text */
.content-frosted-wrapper article header a[class*="text-"],
.content-frosted-wrapper article header a h2[class*="text-"],
.content-frosted-wrapper article header a[class*="dark:text-"],
.content-frosted-wrapper article header a h2[class*="dark:text-"] {
  color: #1a1a1a !important;
}

.dark .content-frosted-wrapper article header a[class*="text-"],
.dark .content-frosted-wrapper article header a h2[class*="text-"],
.dark .content-frosted-wrapper article header a[class*="dark:text-"],
.dark .content-frosted-wrapper article header a h2[class*="dark:text-"] {
  color: #f0f0f0 !important;
}

/* Force show all text in article headers */
.content-frosted-wrapper article header,
.content-frosted-wrapper article header *,
.content-frosted-wrapper article header a,
.content-frosted-wrapper article header a *,
.content-frosted-wrapper article header a h2,
.content-frosted-wrapper article header a h2 * {
  color: #1a1a1a !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
  pointer-events: auto !important;
  order: -1 !important;
}

/* Ensure header is at the top of the article content */
.content-frosted-wrapper article > div > header {
  order: -1 !important;
  display: block !important;
  position: relative !important;
  z-index: 10 !important;
  margin-top: 0 !important;
  margin-bottom: 0.5rem !important;
}

/* Ensure article content div displays header first */
.content-frosted-wrapper article > div.p-4 {
  display: flex !important;
  flex-direction: column !important;
}

.content-frosted-wrapper article > div.p-4 > header {
  order: 0 !important;
  flex-shrink: 0 !important;
  margin-bottom: 0.5rem !important;
}

.content-frosted-wrapper article > div.p-4 > div.text-sm {
  order: 1 !important;
  flex-shrink: 0 !important;
}

.content-frosted-wrapper article > div.p-4 > div.prose {
  order: 2 !important;
  flex-shrink: 0 !important;
}

/* Ensure header is always visible at the top */
.content-frosted-wrapper article > div.p-4 > header {
  position: relative !important;
  z-index: 10 !important;
  display: block !important;
  width: 100% !important;
  visibility: visible !important;
  opacity: 1 !important;
  height: auto !important;
  min-height: auto !important;
  overflow: visible !important;
}

/* Override any rules that might hide article headers */
.content-frosted-wrapper article header,
article header {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  height: auto !important;
  min-height: auto !important;
  overflow: visible !important;
}

.dark .content-frosted-wrapper article header,
.dark .content-frosted-wrapper article header *,
.dark .content-frosted-wrapper article header a,
.dark .content-frosted-wrapper article header a *,
.dark .content-frosted-wrapper article header a h2,
.dark .content-frosted-wrapper article header a h2 * {
  color: #f0f0f0 !important;
  visibility: visible !important;
  opacity: 1 !important;
  display: block !important;
  pointer-events: auto !important;
}

/* Ensure no element is blocking the link */
.content-frosted-wrapper article header a * {
  pointer-events: none !important;
}

.content-frosted-wrapper article header a {
  pointer-events: auto !important;
}

/* Override ALL possible text color classes - highest priority */
.content-frosted-wrapper article header a[class*="text-neutral"],
.content-frosted-wrapper article header a h2[class*="text-neutral"],
.content-frosted-wrapper article header a[class*="text-800"],
.content-frosted-wrapper article header a h2[class*="text-800"],
.content-frosted-wrapper article header a[class*="text-100"],
.content-frosted-wrapper article header a h2[class*="text-100"] {
  color: #1a1a1a !important;
}

.dark .content-frosted-wrapper article header a[class*="text-neutral"],
.dark .content-frosted-wrapper article header a h2[class*="text-neutral"],
.dark .content-frosted-wrapper article header a[class*="text-800"],
.dark .content-frosted-wrapper article header a h2[class*="text-800"],
.dark .content-frosted-wrapper article header a[class*="text-100"],
.dark .content-frosted-wrapper article header a h2[class*="text-100"] {
  color: #f0f0f0 !important;
}

/* Ensure article titles in archive/list pages respect dark theme */
.dark .content-frosted-wrapper article header a.text-neutral-800,
.dark .content-frosted-wrapper article header a h2 {
  color: #f0f0f0 !important;
}

.dark .content-frosted-wrapper article header a.text-neutral-800:hover,
.dark .content-frosted-wrapper article header a h2:hover {
  color: #60a5fa !important;
}

.content-frosted-wrapper article h2 a:hover {
  color: #3b82f6 !important;
  text-decoration: underline !important;
}

.dark .content-frosted-wrapper article h2 a:hover {
  color: #60a5fa !important;
}

/* Force remove all backgrounds with highest specificity */
/* 排除表格元素和代码块元素，让它们样式可以正常显示 */
html body main#main-content .content-frosted-wrapper *:not(table):not(thead):not(tbody):not(tr):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label),
html body main#main-content .content-frosted-wrapper *:not(table):not(thead):not(tbody):not(tr):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)::before,
html body main#main-content .content-frosted-wrapper *:not(table):not(thead):not(tbody):not(tr):not(td):not(th):not(.chroma):not(.chroma *):not(.highlight):not(.highlight *):not(pre):not(pre *):not(code):not(.code-lang-label)::after {
  background: transparent !important;
  background-color: transparent !important;
  background-image: none !important;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
  box-shadow: none !important;
  border: none !important;
  border-radius: 0 !important;
  border-color: transparent !important;
}

/* 确保表格元素不受上面的规则影响 */
html body main#main-content .content-frosted-wrapper table,
html body main#main-content .content-frosted-wrapper table *,
html body main#main-content .content-frosted-wrapper thead,
html body main#main-content .content-frosted-wrapper thead *,
html body main#main-content .content-frosted-wrapper tbody,
html body main#main-content .content-frosted-wrapper tbody *,
html body main#main-content .content-frosted-wrapper tr,
html body main#main-content .content-frosted-wrapper tr *,
html body main#main-content .content-frosted-wrapper td,
html body main#main-content .content-frosted-wrapper th {
  background: unset !important;
  background-color: unset !important;
  background-image: unset !important;
  backdrop-filter: unset !important;
  -webkit-backdrop-filter: unset !important;
  box-shadow: unset !important;
  border: unset !important;
  border-radius: unset !important;
  border-color: unset !important;
}

/* Allow styling for article metadata and author sections - Use unset to allow custom styles */
html body main#main-content .content-frosted-wrapper #single_header > div:first-of-type,
html body main#main-content .content-frosted-wrapper #single_header > div:first-of-type *,
html body main#main-content .content-frosted-wrapper #single_header .author,
html body main#main-content .content-frosted-wrapper #single_header .author *,
html body main#main-content .content-frosted-wrapper #single_header .author img,
html body main#main-content .content-frosted-wrapper #single_header .flex.flex-row.flex-wrap.items-center a.relative,
html body main#main-content .content-frosted-wrapper #single_header .flex.flex-row.flex-wrap.items-center a.relative *,
html body main#main-content .content-frosted-wrapper #single_header .flex.flex-row.flex-wrap.items-center a.relative span {
  background: unset !important;
  background-color: unset !important;
  background-image: unset !important;
  backdrop-filter: unset !important;
  -webkit-backdrop-filter: unset !important;
  box-shadow: unset !important;
  border: unset !important;
  border-radius: unset !important;
  border-color: unset !important;
  border-width: unset !important;
  border-style: unset !important;
}
</style>

<script>
// Force apply styles after page load
(function() {
  function forceRemoveBackgrounds() {
    // 排除代码块和表格元素
    const wrapper = document.querySelector('.content-frosted-wrapper');
    if (!wrapper) return;
    
    // Get all elements inside wrapper, but exclude table and code block elements
    const allElements = wrapper.querySelectorAll('*');
    
    // Table-related tag names to exclude
    const tableTags = ['TABLE', 'THEAD', 'TBODY', 'TFOOT', 'TR', 'TD', 'TH'];
    
    allElements.forEach(function(el) {
      // Skip table elements - let them use their custom styles
      if (tableTags.includes(el.tagName)) {
        return;
      }
      
      // Also skip if element is inside a table
      if (el.closest('table')) {
        return;
      }
      
      // Skip code block elements - let them use their custom styles
      if (el.classList.contains('chroma') || 
          el.classList.contains('highlight') || 
          el.tagName === 'PRE' || 
          el.tagName === 'CODE' ||
          el.classList.contains('code-lang-label')) {
        return;
      }
      
      // Also skip if element is inside a code block
      if (el.closest('.chroma') || el.closest('.highlight') || el.closest('pre')) {
        return;
      }
      
      // Force remove all backgrounds
      el.style.setProperty('background', 'transparent', 'important');
      el.style.setProperty('background-color', 'transparent', 'important');
      el.style.setProperty('background-image', 'none', 'important');
      el.style.setProperty('backdrop-filter', 'none', 'important');
      el.style.setProperty('-webkit-backdrop-filter', 'none', 'important');
      el.style.setProperty('box-shadow', 'none', 'important');
      el.style.setProperty('border', 'none', 'important');
      el.style.setProperty('border-radius', '0', 'important');
      el.style.setProperty('border-color', 'transparent', 'important');
      
      // Remove bg- classes
      const classes = el.className;
      if (classes && typeof classes === 'string') {
        const bgClasses = classes.split(' ').filter(function(c) {
          return c.startsWith('bg-') || c.startsWith('bg-neutral') || c.startsWith('bg-white') || c.startsWith('bg-gray') || c.startsWith('bg-slate');
        });
        bgClasses.forEach(function(c) {
          el.classList.remove(c);
        });
      }
    });
  }
  
  // Run immediately
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(forceRemoveBackgrounds, 100);
    });
  } else {
    setTimeout(forceRemoveBackgrounds, 100);
  }
  
  // Also run after a delay to catch dynamically loaded content
  setTimeout(forceRemoveBackgrounds, 500);
  setTimeout(forceRemoveBackgrounds, 1000);
  
  // Force table background based on theme
  function forceTableBackground() {
    const isDark = document.documentElement.classList.contains('dark');
    
    // Get all table elements
    const tableHeaders = document.querySelectorAll('.content-frosted-wrapper .article-content thead, .content-frosted-wrapper .prose thead, .content-frosted-wrapper .article-content .prose thead');
    const headerCells = document.querySelectorAll('.content-frosted-wrapper .article-content thead th, .content-frosted-wrapper .prose thead th, .content-frosted-wrapper .article-content .prose thead th');
    const evenRows = document.querySelectorAll('.content-frosted-wrapper .article-content tbody tr:nth-child(even), .content-frosted-wrapper .prose tbody tr:nth-child(even), .content-frosted-wrapper .article-content .prose tbody tr:nth-child(even)');
    const oddRows = document.querySelectorAll('.content-frosted-wrapper .article-content tbody tr:nth-child(odd), .content-frosted-wrapper .prose tbody tr:nth-child(odd), .content-frosted-wrapper .article-content .prose tbody tr:nth-child(odd)');
    const tableCells = document.querySelectorAll('.content-frosted-wrapper .article-content tbody td, .content-frosted-wrapper .prose tbody td, .content-frosted-wrapper .article-content .prose tbody td');
    
    if (isDark) {
      // Dark mode: apply dark styles
      tableHeaders.forEach(function(thead) {
        thead.style.setProperty('background', 'rgba(40, 40, 40, 0.9)', 'important');
        thead.style.setProperty('background-color', 'rgba(40, 40, 40, 0.9)', 'important');
        thead.style.setProperty('background-image', 'none', 'important');
      });
      
      headerCells.forEach(function(th) {
        th.style.setProperty('background', 'rgba(40, 40, 40, 0.9)', 'important');
        th.style.setProperty('background-color', 'rgba(40, 40, 40, 0.9)', 'important');
        th.style.setProperty('background-image', 'none', 'important');
        th.style.setProperty('color', '#ffffff', 'important');
      });
      
      evenRows.forEach(function(row) {
        row.style.setProperty('background', 'rgba(35, 35, 35, 0.7)', 'important');
        row.style.setProperty('background-color', 'rgba(35, 35, 35, 0.7)', 'important');
        row.style.setProperty('background-image', 'none', 'important');
      });
      
      oddRows.forEach(function(row) {
        row.style.setProperty('background', 'rgba(30, 30, 30, 0.7)', 'important');
        row.style.setProperty('background-color', 'rgba(30, 30, 30, 0.7)', 'important');
        row.style.setProperty('background-image', 'none', 'important');
      });
      
      tableCells.forEach(function(td) {
        td.style.setProperty('color', '#ffffff', 'important');
      });
    } else {
      // Light mode: remove inline styles to let CSS rules apply
      tableHeaders.forEach(function(thead) {
        thead.style.removeProperty('background');
        thead.style.removeProperty('background-color');
        thead.style.removeProperty('background-image');
      });
      
      headerCells.forEach(function(th) {
        th.style.removeProperty('background');
        th.style.removeProperty('background-color');
        th.style.removeProperty('background-image');
        th.style.removeProperty('color');
      });
      
      evenRows.forEach(function(row) {
        row.style.removeProperty('background');
        row.style.removeProperty('background-color');
        row.style.removeProperty('background-image');
      });
      
      oddRows.forEach(function(row) {
        row.style.removeProperty('background');
        row.style.removeProperty('background-color');
        row.style.removeProperty('background-image');
      });
      
      tableCells.forEach(function(td) {
        td.style.removeProperty('color');
      });
    }
  }
  
  // Force code block background based on theme
  function forceCodeBlockBackground() {
    const isDark = document.documentElement.classList.contains('dark');
    
    // 移除外层容器（.chroma, .highlight）的背景色，保持透明
    const outerContainers = document.querySelectorAll('.content-frosted-wrapper .prose .chroma, .content-frosted-wrapper .prose .highlight');
    outerContainers.forEach(function(container) {
      container.style.setProperty('background', 'transparent', 'important');
      container.style.setProperty('background-color', 'transparent', 'important');
      container.style.setProperty('background-image', 'none', 'important');
      container.style.setProperty('border', 'none', 'important');
      container.style.setProperty('box-shadow', 'none', 'important');
    });
    
    // 移除 .lntable 的背景色，保持透明
    const lntables = document.querySelectorAll('.content-frosted-wrapper .prose .chroma .lntable, .content-frosted-wrapper .prose .highlight .lntable');
    lntables.forEach(function(el) {
      el.style.setProperty('background', 'transparent', 'important');
      el.style.setProperty('background-color', 'transparent', 'important');
      el.style.setProperty('background-image', 'none', 'important');
    });
    
    // 移除 tr 的背景色，保持透明
    const trs = document.querySelectorAll('.content-frosted-wrapper .prose .chroma tr, .content-frosted-wrapper .prose .highlight tr');
    trs.forEach(function(el) {
      el.style.setProperty('background', 'transparent', 'important');
      el.style.setProperty('background-color', 'transparent', 'important');
      el.style.setProperty('background-image', 'none', 'important');
    });
    
    // 只对内部的 pre 元素设置透明背景
    const preElements = document.querySelectorAll('.content-frosted-wrapper .prose .chroma pre, .content-frosted-wrapper .prose .highlight pre, .content-frosted-wrapper .prose pre');
    preElements.forEach(function(pre) {
      pre.style.setProperty('background', 'transparent', 'important');
      pre.style.setProperty('background-color', 'transparent', 'important');
      pre.style.setProperty('background-image', 'none', 'important');
    });
    
    // 对代码列设置透明背景
    const codeColumns = document.querySelectorAll('.content-frosted-wrapper .prose .chroma .lntd:last-child, .content-frosted-wrapper .prose .highlight .lntd:last-child');
    codeColumns.forEach(function(column) {
      column.style.setProperty('background', 'transparent', 'important');
      column.style.setProperty('background-color', 'transparent', 'important');
      column.style.setProperty('background-image', 'none', 'important');
    });
    
    const lineNumberColumns = document.querySelectorAll('.content-frosted-wrapper .prose .chroma .lntd:first-child, .content-frosted-wrapper .prose .highlight .lntd:first-child');
    lineNumberColumns.forEach(function(column) {
      column.style.setProperty('background', 'transparent', 'important');
      column.style.setProperty('background-color', 'transparent', 'important');
      column.style.setProperty('background-image', 'none', 'important');
    });
  }
  
  // Run immediately
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(forceTableBackground, 100);
      setTimeout(forceTableBackground, 500);
      setTimeout(forceTableBackground, 1000);
      setTimeout(forceCodeBlockBackground, 100);
      setTimeout(forceCodeBlockBackground, 500);
      setTimeout(forceCodeBlockBackground, 1000);
    });
  } else {
    setTimeout(forceTableBackground, 100);
    setTimeout(forceTableBackground, 500);
    setTimeout(forceTableBackground, 1000);
    setTimeout(forceCodeBlockBackground, 100);
    setTimeout(forceCodeBlockBackground, 500);
    setTimeout(forceCodeBlockBackground, 1000);
  }
  
  // Watch for theme changes
  const themeObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
        setTimeout(forceTableBackground, 100);
        setTimeout(forceTableBackground, 500);
        setTimeout(forceCodeBlockBackground, 100);
        setTimeout(forceCodeBlockBackground, 500);
      }
    });
  });
  
  themeObserver.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['class']
  });
  
  // Watch for new code blocks and tables
  const contentObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        setTimeout(forceTableBackground, 100);
        setTimeout(forceCodeBlockBackground, 100);
      }
    });
  });
  
  contentObserver.observe(document.body, {
    childList: true,
    subtree: true
  });
})();

</script>

<!-- Global Background -->
<div class="global-background">
  {{ $defaultBgPath := "/images/background.png" }}
  {{ if .Site.BaseURL }}
    {{ $baseURL := strings.TrimSuffix "/" .Site.BaseURL }}
    {{ $defaultBgPath = printf "%s/images/background.png" $baseURL }}
  {{ end }}
  <img
    id="global-background-image"
    src="{{ $defaultBgPath }}"
    alt="Background"
    style="width: 100%; height: 100%; object-fit: cover; display: block;"
    onerror="console.error('Background image failed to load:', this.src); this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.display='block';">
</div>

<!-- Background Image Configuration -->
<script>
  // 立即设置主题切换监听（必须在其他代码之前）
  (function() {
    // 使用事件委托，在捕获阶段监听所有点击
    document.addEventListener('click', function(event) {
      const target = event.target;
      // 检查是否点击了主题切换按钮或其子元素
      const button = target.closest('#appearance-switcher, #appearance-switcher-mobile, #fixed-appearance-switcher');
      if (button) {
        // 等待 appearance.js 完成主题切换后，再切换背景图
        setTimeout(function() {
          if (typeof loadBackgroundImage === 'function') {
            loadBackgroundImage();
          }
        }, 100);
      }
    }, true); // 使用捕获阶段，确保在其他监听器之前执行
  })();
  
  (function() {
    // Day images list
    const dayImages = [
      "1017f4097097d999dcdbf7ef79026e11.png",
      "140526d3500dd876f50ece7bfb72ba54.png",
      "368c9692c58f2b8b277f982ec4cbe6f2.png",
      "3ecac5dee49fabfa42465e7fd59b1b57.png",
      "504cebc0c21eaa2834b489302c57b8c0.png",
      "55c2a20739e6fc330daa249451eb2840.png",
      "632b67e4e8aeb588a3ff2b0585bd3a8b.png",
      "7aac5c282795ad454e6506caa2b06cc4.png",
      "8e5cd9e57e0530e476d958b840dc8607.png",
      "b713e0bc84a5bd6d442d3ed1e0614d42.png",
      "d431c141a75bbf8fe24ea34f5f990b02.png",
      "da3dada4b928700a614d79ce9d80f9a4.png",
      "e141f4825fcb18929ea76a220b95b451.png",
      "e2f5c14ccb7050a1bedad92ecd551bfd.png",
      "e3afbe67acdaf11f1766f65a3b3265e2.png",
      "f4b68290e172eb46d2d0659b042fd40c.png",
      "f6e06e41bf06e1f0595a0fceee93e36c.png",
      "f96dc4c92b6a1c451a1bb60960e04e49.png"
    ];
    
    // Night images list
    const nightImages = [
      "420ef354b7e5c46e67ca430592510ee8.png",
      "4389ff517b87f2fcdde61e930ed477c2.png",
      "5b4df5eff935e82ac52f35fd50724c04.png"
    ];
    
    // Default background
    const defaultBg = "{{ $defaultBgPath }}";
    
    // Base URL for images
    const baseURL = "{{ .Site.BaseURL }}";
    const imagesBasePath = baseURL ? (baseURL.endsWith('/') ? baseURL.slice(0, -1) : baseURL) + "/images" : "/images";
    
    // Determine if it's day or night based on current time
    function isDayTime() {
      const hour = new Date().getHours();
      // Day: 6:00 - 18:00 (6 AM - 6 PM)
      // Night: 18:00 - 6:00 (6 PM - 6 AM)
      return hour >= 6 && hour < 18;
    }
    
    // Determine if should use day or night images
    // Priority: manual theme toggle > time-based
    function shouldUseDayImages() {
      // Check if user has manually set a theme preference
      const userPreference = localStorage.getItem("appearance");
      const isDarkMode = document.documentElement.classList.contains("dark");
      
      // If user has manually set dark mode, use night images
      // If user has manually set light mode, use day images
      // Otherwise, use time-based logic
      if (userPreference === "dark") {
        return false; // Use night images
      } else if (userPreference === "light") {
        return true; // Use day images
      } else {
        // No manual preference, use time-based logic
        return isDayTime();
      }
    }
    
    // Get random image from array
    function getRandomImage(images) {
      if (images.length === 0) return null;
      const randomIndex = Math.floor(Math.random() * images.length);
      return images[randomIndex];
    }
    
    // Load background image
    function loadBackgroundImage() {
      const bgImage = document.getElementById('global-background-image');
      if (!bgImage) return;
      
      const useDayImages = shouldUseDayImages();
      const imageFolder = useDayImages ? 'day' : 'night';
      const imageList = useDayImages ? dayImages : nightImages;
      
      // Get random image
      const randomImage = getRandomImage(imageList);
      let imagePath = defaultBg; // Fallback to default
      
      if (randomImage) {
        imagePath = imagesBasePath + "/" + imageFolder + "/" + randomImage;
      }
      
      // Create new image to preload
      const img = new Image();
      img.onload = function() {
        // Image loaded successfully, update background
        bgImage.src = imagePath;
        bgImage.style.display = 'block';
      };
      img.onerror = function() {
        // Image failed to load, try default
        console.warn('Failed to load image:', imagePath, 'Using default background');
        bgImage.src = defaultBg;
        bgImage.style.display = 'block';
        
        // If default also fails, use gradient
        bgImage.onerror = function() {
          bgImage.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
          bgImage.style.display = 'block';
        };
      };
      
      // Start loading
      img.src = imagePath;
    }
    
    // Watch for theme changes - 使用 MutationObserver 监听主题变化
    function watchThemeChanges() {
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            setTimeout(function() {
              loadBackgroundImage();
            }, 100);
          }
        });
      });
      
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });
    }
    
    // Initialize background and watch for changes
    function initBackground() {
      // Load background when page loads
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          loadBackgroundImage();
          watchThemeChanges();
        });
      } else {
        loadBackgroundImage();
        watchThemeChanges();
      }
    }
    
    initBackground();
  })();
</script>

