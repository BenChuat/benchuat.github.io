<!doctype html>
<html
  lang="{{ with site.Params.isoCode | default (site.LanguageCode | default `en`) }}{{- . -}}{{ end }}"
  dir="{{ cond (site.Params.rtl | default false) `rtl` `ltr` }}"
  class="scroll-smooth"
  data-default-appearance="{{ site.Params.defaultAppearance | default `light` }}"
  data-auto-appearance="{{ site.Params.autoSwitchAppearance | default `true` }}">
  {{- partial "head.html" . -}}
  {{- partialCached "init.html" . -}}

  {{ $bodyLayout := "flex flex-col h-screen m-auto leading-7" }}
  {{ $bodyColor := "text-lg text-neutral-900 dark:text-neutral" }}
  {{ $bodyScrollbar := "scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600" }}
  <body class="{{ $bodyLayout }} {{ $bodyColor }} {{ $bodyScrollbar }}">
    {{- partial "global-background.html" . -}}
    {{/* Global fixed top bar - show on all pages except homepage */}}
    {{- if not .IsHome -}}
      {{- partial "global-fixed-top-bar.html" . -}}
    {{- end -}}
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content">
        <span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
        {{ i18n "nav.skip_to_main" }}
      </a>
    </div>
    {{/* Render header on all pages, but hide it on non-homepage pages */}}
    {{ $header := print "header/" site.Params.header.layout ".html" }}
    {{ if templates.Exists ( printf "partials/%s" $header ) }}
      {{ partial $header . }}
    {{ else }}
      {{ partial "header/basic.html" . }}
    {{ end }}
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        {{ block "main" . }}{{ end }}
        {{ if and (site.Params.footer.showScrollToTop | default true) }}
          {{- partial "scroll-to-top.html" . -}}
        {{ end }}
      </main>
      {{- partial "footer.html" . -}}
      {{ if site.Params.enableSearch | default false }}
        {{- partial "search.html" . -}}
      {{ end }}
    </div>
    
    {{/* Ensure typewriter animation works on all pages including article pages */}}
    {{ if not .IsHome }}
    <script>
    (function() {
      console.log('[Base Layout] Typewriter checker initialized for article/non-home pages');
      
      // Multiple attempts to ensure typewriter works
      function checkAndFixTypewriter() {
        const element = document.getElementById('fixed-top-typewriter-headline');
        if (!element) {
          console.warn('[Base Layout] Typewriter element not found yet');
          return false;
        }
        
        const currentText = element.textContent || '';
        const isInitialized = element.dataset.initialized === 'true';
        
        // Check if it's working (has animated content)
        if (isInitialized && currentText !== '' && currentText !== "I'm only human" && currentText.length > 3) {
          console.log('[Base Layout] Typewriter is working, text:', currentText.substring(0, 20) + '...');
          return true;
        }
        
        // Not working, trigger fix
        console.log('[Base Layout] Typewriter not working, current text:', currentText, 'initialized:', isInitialized);
        element.dataset.initialized = 'false';
        const event = new CustomEvent('forceTypewriterInit');
        document.dispatchEvent(event);
        return false;
      }
      
      // Try immediately
      setTimeout(checkAndFixTypewriter, 500);
      
      // Try after DOM ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          setTimeout(checkAndFixTypewriter, 500);
          setTimeout(checkAndFixTypewriter, 2000);
        });
      } else {
        setTimeout(checkAndFixTypewriter, 500);
        setTimeout(checkAndFixTypewriter, 2000);
      }
      
      // Try after page load
      window.addEventListener('load', function() {
        setTimeout(checkAndFixTypewriter, 1000);
        setTimeout(checkAndFixTypewriter, 3000);
      });
    })();
    </script>
    {{ end }}
  </body>
  {{ if site.Params.buymeacoffee.globalWidget | default false }}
    <script
      data-name="BMC-Widget"
      data-cfasync="false"
      src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
      data-id="{{ site.Params.buymeacoffee.identifier }}"
      data-description="Support me on Buy me a coffee!"
      {{ with site.Params.buymeacoffee.globalWidgetMessage }}data-message="{{ . }}"{{ end }}
      {{ with site.Params.buymeacoffee.globalWidgetColor | default `#FFDD00` }}data-color="{{ . }}"{{ end }}
      {{ with site.Params.buymeacoffee.globalWidgetPosition }}data-position="{{ . }}"{{ end }}
      data-x_margin="18"
      data-y_margin="18"></script>
  {{ end }}
</html>

