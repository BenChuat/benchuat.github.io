{{ define "main" }}
  {{ .Scratch.Set "scope" "single" }}
  <style>
  /* Additional page-specific styles - global styles are in global-background.html */
  .content-frosted-wrapper > article {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
  
  .content-frosted-wrapper > article > section {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  
  @media (min-width: 1024px) {
    .content-frosted-wrapper > article > section {
      flex-direction: row;
    }
  }

  /* Beautify article metadata section - Clean and modern style */
  /* Override global background rules with highest priority */
  html body main#main-content .content-frosted-wrapper #single_header > div:first-of-type,
  html body main#main-content .content-frosted-wrapper #single_header > div:first-of-type * {
    background: initial !important;
    background-color: initial !important;
    background-image: initial !important;
    border: initial !important;
    border-radius: initial !important;
    box-shadow: initial !important;
  }

  #single_header > div:first-of-type {
    margin-top: 1.5rem !important;
    margin-bottom: 1.5rem !important;
    padding: 0 !important;
    background: transparent !important;
    border: none !important;
  }

  /* Keep metadata in horizontal layout */
  #single_header > div:first-of-type .flex {
    gap: 0.5rem !important;
    align-items: center !important;
    flex-wrap: wrap !important;
    flex-direction: row !important;
    display: flex !important;
  }

  /* Beautify metadata items - clean horizontal style */
  #single_header > div:first-of-type .flex.flex-row {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: wrap !important;
    align-items: center !important;
    gap: 0 !important;
  }

  #single_header > div:first-of-type time,
  #single_header > div:first-of-type span:not(.px-2) {
    color: #6b7280 !important;
    font-size: 0.875rem !important;
    font-weight: normal !important;
    transition: color 0.2s ease !important;
    display: inline !important;
  }

  .dark #single_header > div:first-of-type time,
  .dark #single_header > div:first-of-type span:not(.px-2) {
    color: #9ca3af !important;
  }

  #single_header > div:first-of-type time:hover,
  #single_header > div:first-of-type span:not(.px-2):hover {
    color: #3b82f6 !important;
  }

  .dark #single_header > div:first-of-type time:hover,
  .dark #single_header > div:first-of-type span:not(.px-2):hover {
    color: #60a5fa !important;
  }

  /* Separator dots - subtle gray */
  #single_header > div:first-of-type .px-2 {
    color: #9ca3af !important;
    font-size: 0.75rem !important;
    font-weight: normal !important;
    margin: 0 0.25rem !important;
    display: inline !important;
  }

  .dark #single_header > div:first-of-type .px-2 {
    color: #6b7280 !important;
  }

  /* Beautify taxonomy badges - Pill style with border */
  /* Override global background rules with highest priority */
  html body main#main-content .content-frosted-wrapper #single_header .flex.flex-row.flex-wrap.items-center a.relative,
  html body main#main-content .content-frosted-wrapper #single_header .flex.flex-row.flex-wrap.items-center a.relative *,
  html body main#main-content .content-frosted-wrapper #single_header .flex.flex-row.flex-wrap.items-center a.relative span {
    background: initial !important;
    background-color: initial !important;
    background-image: initial !important;
    border: initial !important;
    border-radius: initial !important;
    box-shadow: initial !important;
  }

  /* Beautify category/tag badges - pill style with border and shadow */
  #single_header .flex.flex-row.flex-wrap.items-center a.relative {
    background: rgba(255, 255, 255, 0.8) !important;
    background-color: rgba(255, 255, 255, 0.8) !important;
    color: #3b82f6 !important;
    padding: 0.5rem 1rem !important;
    border-radius: 9999px !important;
    font-weight: 500 !important;
    font-size: 0.875rem !important;
    transition: all 0.2s ease !important;
    border: 1.5px solid #3b82f6 !important;
    border-width: 1.5px !important;
    border-style: solid !important;
    border-color: #3b82f6 !important;
    text-decoration: none !important;
    margin-top: 0.75rem !important;
    margin-right: 0.5rem !important;
    display: inline-block !important;
    box-shadow: 0 1px 3px rgba(59, 130, 246, 0.2) !important;
  }

  .dark #single_header .flex.flex-row.flex-wrap.items-center a.relative {
    background: rgba(30, 41, 59, 0.8) !important;
    background-color: rgba(30, 41, 59, 0.8) !important;
    color: #60a5fa !important;
    border-color: #60a5fa !important;
    box-shadow: 0 1px 3px rgba(59, 130, 246, 0.3) !important;
  }

  #single_header .flex.flex-row.flex-wrap.items-center a.relative:hover {
    background: rgba(255, 255, 255, 0.95) !important;
    background-color: rgba(255, 255, 255, 0.95) !important;
    color: #2563eb !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3) !important;
  }

  .dark #single_header .flex.flex-row.flex-wrap.items-center a.relative:hover {
    background: rgba(30, 41, 59, 0.95) !important;
    background-color: rgba(30, 41, 59, 0.95) !important;
    color: #93c5fd !important;
    box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4) !important;
  }

  #single_header .flex.flex-row.flex-wrap.items-center a.relative span {
    border: none !important;
    background: transparent !important;
    padding: 0 !important;
    color: inherit !important;
  }

  /* Beautify author section - Clean card style */
  /* Override global background rules with highest priority */
  html body main#main-content .content-frosted-wrapper #single_header .author,
  html body main#main-content .content-frosted-wrapper #single_header .author *,
  html body main#main-content .content-frosted-wrapper #single_header .author img {
    background: initial !important;
    background-color: initial !important;
    background-image: initial !important;
    border: initial !important;
    border-radius: initial !important;
    box-shadow: initial !important;
  }

  #single_header .author {
    background: rgba(255, 255, 255, 0.5) !important;
    background-color: rgba(255, 255, 255, 0.5) !important;
    border-radius: 12px !important;
    padding: 1.25rem !important;
    margin-top: 2rem !important;
    border: 1px solid rgba(229, 231, 235, 0.5) !important;
    border-width: 1px !important;
    border-style: solid !important;
    border-color: rgba(229, 231, 235, 0.5) !important;
    transition: all 0.2s ease !important;
    display: flex !important;
  }

  .dark #single_header .author {
    background: rgba(30, 41, 59, 0.5);
    border: 1px solid rgba(59, 130, 246, 0.2);
  }

  #single_header .author:hover {
    border-color: rgba(59, 130, 246, 0.4);
  }

  .dark #single_header .author:hover {
    border-color: rgba(59, 130, 246, 0.5);
  }

  #single_header .author img {
    border: 2px solid rgba(59, 130, 246, 0.2) !important;
    border-width: 2px !important;
    border-style: solid !important;
    border-color: rgba(59, 130, 246, 0.2) !important;
    transition: all 0.2s ease !important;
  }

  .dark #single_header .author img {
    border-color: rgba(59, 130, 246, 0.3);
  }

  #single_header .author:hover img {
    border-color: rgba(59, 130, 246, 0.4);
  }

  .dark #single_header .author:hover img {
    border-color: rgba(59, 130, 246, 0.5);
  }

  #single_header .author .place-self-center {
    flex: 1;
  }

  #single_header .author .text-\[0\.6rem\] {
    letter-spacing: 0.05em;
    font-weight: 600;
    margin-bottom: 0.375rem;
    color: #6b7280;
    text-transform: uppercase;
  }

  .dark #single_header .author .text-\[0\.6rem\] {
    color: #9ca3af;
  }

  #single_header .author .font-semibold {
    font-size: 1.125rem;
    margin-bottom: 0.25rem;
    color: #1f2937;
    font-weight: 600;
  }

  .dark #single_header .author .font-semibold {
    color: #f3f4f6;
  }

  #single_header .author .text-sm {
    line-height: 1.5;
    margin-bottom: 0.75rem;
    color: #6b7280;
  }

  .dark #single_header .author .text-sm {
    color: #9ca3af;
  }

  #single_header .author .text-2xl a,
  #single_header .author .text-lg a {
    color: #6b7280 !important;
    transition: color 0.2s ease, opacity 0.2s ease !important;
    display: inline-block !important;
    opacity: 0.7 !important;
  }

  .dark #single_header .author .text-2xl a,
  .dark #single_header .author .text-lg a {
    color: #9ca3af;
  }

  #single_header .author .text-2xl a:hover,
  #single_header .author .text-lg a:hover {
    opacity: 1 !important;
    color: #3b82f6 !important;
  }

  .dark #single_header .author .text-2xl a:hover,
  .dark #single_header .author .text-lg a:hover {
    color: #60a5fa !important;
  }

  /* 1. 增大整体字号 */
  .content-frosted-wrapper .prose {
    font-size: 1.125rem !important;
    line-height: 1.8 !important;
    max-width: 100% !important;
    width: 100% !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  .content-frosted-wrapper .prose p {
    font-size: 1.125rem !important;
    line-height: 1.8 !important;
  }

  .content-frosted-wrapper .prose h1 {
    font-size: 2.5rem !important;
    line-height: 1.3 !important;
  }

  .content-frosted-wrapper .prose h2 {
    font-size: 2rem !important;
    line-height: 1.4 !important;
  }

  .content-frosted-wrapper .prose h3 {
    font-size: 1.75rem !important;
    line-height: 1.4 !important;
  }

  .content-frosted-wrapper .prose h4 {
    font-size: 1.5rem !important;
    line-height: 1.5 !important;
  }

  .content-frosted-wrapper .prose li {
    font-size: 1.125rem !important;
    line-height: 1.8 !important;
  }

  /* 2. 优化代码块样式 - 深色背景和语法高亮 */
  /* 支持多种代码块格式：.chroma, .highlight, pre code */
  .content-frosted-wrapper .prose .chroma,
  .content-frosted-wrapper .prose .highlight,
  .content-frosted-wrapper .prose pre,
  .content-frosted-wrapper .prose pre code {
    background: #282c34 !important;
    background-color: #282c34 !important;
    color: #abb2bf !important;
    border-radius: 8px !important;
    padding: 1.25rem !important;
    margin: 1.5rem 0 !important;
    overflow-x: auto !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
  }

  .content-frosted-wrapper .prose pre code {
    padding: 0 !important;
    background: transparent !important;
    background-color: transparent !important;
  }

  .content-frosted-wrapper .prose .chroma .lntable,
  .content-frosted-wrapper .prose .highlight .lntable {
    background: transparent !important;
    padding: 0 !important;
  }

  .content-frosted-wrapper .prose .chroma .lnt,
  .content-frosted-wrapper .prose .chroma .ln,
  .content-frosted-wrapper .prose .highlight .lnt,
  .content-frosted-wrapper .prose .highlight .ln {
    color: #5c6370 !important;
    margin-right: 1rem !important;
    padding: 0 !important;
    user-select: none !important;
  }

  /* 代码高亮颜色 - 参考图片样式 */
  .content-frosted-wrapper .prose .chroma .k,
  .content-frosted-wrapper .prose .chroma .kd,
  .content-frosted-wrapper .prose .chroma .kn,
  .content-frosted-wrapper .prose .chroma .kp,
  .content-frosted-wrapper .prose .chroma .kr,
  .content-frosted-wrapper .prose .chroma .o,
  .content-frosted-wrapper .prose .highlight .k,
  .content-frosted-wrapper .prose .highlight .kd,
  .content-frosted-wrapper .prose .highlight .kn,
  .content-frosted-wrapper .prose .highlight .kp,
  .content-frosted-wrapper .prose .highlight .kr,
  .content-frosted-wrapper .prose .highlight .o {
    color: #c678dd !important; /* 紫色 - 关键字 */
  }

  .content-frosted-wrapper .prose .chroma .s,
  .content-frosted-wrapper .prose .chroma .s1,
  .content-frosted-wrapper .prose .chroma .s2,
  .content-frosted-wrapper .prose .chroma .sh,
  .content-frosted-wrapper .prose .highlight .s,
  .content-frosted-wrapper .prose .highlight .s1,
  .content-frosted-wrapper .prose .highlight .s2,
  .content-frosted-wrapper .prose .highlight .sh {
    color: #98c379 !important; /* 绿色 - 字符串 */
  }

  .content-frosted-wrapper .prose .chroma .m,
  .content-frosted-wrapper .prose .chroma .mi,
  .content-frosted-wrapper .prose .chroma .mf,
  .content-frosted-wrapper .prose .highlight .m,
  .content-frosted-wrapper .prose .highlight .mi,
  .content-frosted-wrapper .prose .highlight .mf {
    color: #d19a66 !important; /* 橙色 - 数字 */
  }

  .content-frosted-wrapper .prose .chroma .c,
  .content-frosted-wrapper .prose .chroma .c1,
  .content-frosted-wrapper .prose .chroma .cm,
  .content-frosted-wrapper .prose .highlight .c,
  .content-frosted-wrapper .prose .highlight .c1,
  .content-frosted-wrapper .prose .highlight .cm {
    color: #5c6370 !important; /* 灰色 - 注释 */
    font-style: italic !important;
  }

  .content-frosted-wrapper .prose .chroma .nf,
  .content-frosted-wrapper .prose .chroma .na,
  .content-frosted-wrapper .prose .highlight .nf,
  .content-frosted-wrapper .prose .highlight .na {
    color: #61afef !important; /* 蓝色 - 函数 */
  }

  .content-frosted-wrapper .prose .chroma .nb,
  .content-frosted-wrapper .prose .highlight .nb {
    color: #e5c07b !important; /* 黄色 - 内置函数 */
  }

  /* 行内代码样式 */
  .content-frosted-wrapper .prose code:not(pre code) {
    background: #f3f4f6 !important;
    background-color: #f3f4f6 !important;
    color: #e11d48 !important;
    padding: 0.125rem 0.375rem !important;
    border-radius: 0.25rem !important;
    font-size: 0.875em !important;
  }

  .dark .content-frosted-wrapper .prose code:not(pre code) {
    background: #374151 !important;
    background-color: #374151 !important;
    color: #f87171 !important;
  }

  /* 3. 优化表格显示 - 毛玻璃风格，与整体协调 */
  /* 使用最高优先级选择器覆盖所有全局规则 */
  html body main#main-content .content-frosted-wrapper .prose table,
  html body main#main-content .content-frosted-wrapper .article-content .prose table,
  html body main#main-content .content-frosted-wrapper article .prose table {
    display: table !important;
    width: 100% !important;
    max-width: 100% !important;
    min-width: 100% !important;
    border-collapse: collapse !important;
    margin: 1.5rem 0 !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
    font-size: 1.125rem !important;
    border: 1px solid rgba(255, 255, 255, 0.4) !important;
    border-radius: 12px !important;
    overflow: hidden !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
    background: rgba(255, 255, 255, 0.5) !important;
    background-color: rgba(255, 255, 255, 0.5) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    box-sizing: border-box !important;
    table-layout: auto !important;
  }

  .dark html body main#main-content .content-frosted-wrapper .prose table,
  .dark html body main#main-content .content-frosted-wrapper .article-content .prose table,
  .dark html body main#main-content .content-frosted-wrapper article .prose table {
    border-color: rgba(255, 255, 255, 0.12) !important;
    background: rgba(35, 35, 35, 0.5) !important;
    background-color: rgba(35, 35, 35, 0.5) !important;
  }

  html body main#main-content .content-frosted-wrapper .prose thead,
  html body main#main-content .content-frosted-wrapper .article-content .prose thead,
  html body main#main-content .content-frosted-wrapper article .prose thead {
    background: rgba(255, 255, 255, 0.7) !important;
    background-color: rgba(255, 255, 255, 0.7) !important;
    display: table-header-group !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
  }

  .dark html body main#main-content .content-frosted-wrapper .prose thead,
  .dark html body main#main-content .content-frosted-wrapper .article-content .prose thead,
  .dark html body main#main-content .content-frosted-wrapper article .prose thead {
    background: rgba(30, 30, 30, 0.55) !important;
    background-color: rgba(30, 30, 30, 0.55) !important;
  }

  html body main#main-content .content-frosted-wrapper .prose thead th,
  html body main#main-content .content-frosted-wrapper .article-content .prose thead th,
  html body main#main-content .content-frosted-wrapper article .prose thead th {
    padding: 0.875rem 1rem !important;
    text-align: left !important;
    font-weight: 600 !important;
    color: #1a1a1a !important;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
    border-right: 1px solid rgba(0, 0, 0, 0.08) !important;
    font-size: 1.125rem !important;
    background: rgba(255, 255, 255, 0.7) !important;
    background-color: rgba(255, 255, 255, 0.7) !important;
  }

  .dark html body main#main-content .content-frosted-wrapper .prose thead th,
  .dark html body main#main-content .content-frosted-wrapper .article-content .prose thead th,
  .dark html body main#main-content .content-frosted-wrapper article .prose thead th {
    color: #d1d5db !important;
    border-bottom-color: rgba(255, 255, 255, 0.1) !important;
    border-right-color: rgba(255, 255, 255, 0.08) !important;
    background: rgba(30, 30, 30, 0.55) !important;
    background-color: rgba(30, 30, 30, 0.55) !important;
  }

  html body main#main-content .content-frosted-wrapper .prose tbody tr,
  html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr,
  html body main#main-content .content-frosted-wrapper article .prose tbody tr {
    border-bottom: 1px solid rgba(0, 0, 0, 0.08) !important;
    transition: background-color 0.2s ease !important;
  }

  .dark html body main#main-content .content-frosted-wrapper .prose tbody tr,
  .dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr,
  .dark html body main#main-content .content-frosted-wrapper article .prose tbody tr {
    border-bottom-color: rgba(255, 255, 255, 0.12) !important;
  }

  html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(even),
  html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(even),
  html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(even) {
    background: rgba(255, 255, 255, 0.3) !important;
    background-color: rgba(255, 255, 255, 0.3) !important;
  }

  .dark html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(even),
  .dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(even),
  .dark html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(even) {
    background: rgba(40, 40, 40, 0.35) !important;
    background-color: rgba(40, 40, 40, 0.35) !important;
  }

  html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(odd),
  html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(odd),
  html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(odd) {
    background: rgba(255, 255, 255, 0.2) !important;
    background-color: rgba(255, 255, 255, 0.2) !important;
  }

  .dark html body main#main-content .content-frosted-wrapper .prose tbody tr:nth-child(odd),
  .dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:nth-child(odd),
  .dark html body main#main-content .content-frosted-wrapper article .prose tbody tr:nth-child(odd) {
    background: rgba(38, 38, 38, 0.3) !important;
    background-color: rgba(38, 38, 38, 0.3) !important;
  }

  html body main#main-content .content-frosted-wrapper .prose tbody tr:hover,
  html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:hover,
  html body main#main-content .content-frosted-wrapper article .prose tbody tr:hover {
    background: rgba(255, 255, 255, 0.5) !important;
    background-color: rgba(255, 255, 255, 0.5) !important;
  }

  .dark html body main#main-content .content-frosted-wrapper .prose tbody tr:hover,
  .dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody tr:hover,
  .dark html body main#main-content .content-frosted-wrapper article .prose tbody tr:hover {
    background: rgba(48, 48, 48, 0.45) !important;
    background-color: rgba(48, 48, 48, 0.45) !important;
  }

  html body main#main-content .content-frosted-wrapper .prose tbody td,
  html body main#main-content .content-frosted-wrapper .article-content .prose tbody td,
  html body main#main-content .content-frosted-wrapper article .prose tbody td {
    padding: 0.875rem 1rem !important;
    border-right: 1px solid rgba(0, 0, 0, 0.08) !important;
    font-size: 1.125rem !important;
    line-height: 1.6 !important;
  }

  .dark html body main#main-content .content-frosted-wrapper .prose tbody td,
  .dark html body main#main-content .content-frosted-wrapper .article-content .prose tbody td,
  .dark html body main#main-content .content-frosted-wrapper article .prose tbody td {
    border-right-color: rgba(255, 255, 255, 0.12) !important;
  }

  html body main#main-content .content-frosted-wrapper .prose thead th:last-child,
  html body main#main-content .content-frosted-wrapper .article-content .prose thead th:last-child,
  html body main#main-content .content-frosted-wrapper article .prose thead th:last-child,
  html body main#main-content .content-frosted-wrapper .prose tbody td:last-child,
  html body main#main-content .content-frosted-wrapper .article-content .prose tbody td:last-child,
  html body main#main-content .content-frosted-wrapper article .prose tbody td:last-child {
    border-right: none !important;
    border-right-width: 0 !important;
    border-right-style: none !important;
    padding-right: 1rem !important;
  }
  

  </style>
  
  <div class="content-frosted-wrapper">
    <article>
      {{/* Hero */}}
      {{ if .Params.showHero | default (site.Params.article.showHero | default false) }}
        {{ $heroStyle := .Params.heroStyle }}
        {{ if not $heroStyle }}{{ $heroStyle = site.Params.article.heroStyle }}{{ end }}
        {{ $heroStyle := print "hero/" $heroStyle ".html" }}
        {{ if templates.Exists ( printf "partials/%s" $heroStyle ) }}
          {{ partial $heroStyle . }}
        {{ else }}
          {{ partial "hero/basic.html" . }}
        {{ end }}
      {{ end }}

      {{/* Header */}}
      <header id="single_header" class="mt-5">
        {{ if .Params.showBreadcrumbs | default (site.Params.article.showBreadcrumbs | default false) }}
          {{ partial "breadcrumbs.html" . }}
        {{ end }}
        <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
          {{ .Title | emojify }}
        </h1>
        <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          {{ partial "article-meta/basic.html" (dict "context" . "scope" "single") }}
        </div>
        {{ if not (.Params.showAuthorBottom | default (site.Params.article.showAuthorBottom | default false)) }}
          {{ template "SingleAuthor" . }}
        {{ end }}
      </header>

      {{/* Body */}}
      <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
        {{ $enableToc := site.Params.article.showTableOfContents | default false }}
        {{ $enableToc = .Params.showTableOfContents | default $enableToc }}
        {{ $showToc := and $enableToc (in .TableOfContents "<ul") }}
        {{ $topClass := cond (hasPrefix site.Params.header.layout "fixed") "lg:top-[140px]" "lg:top-10" }}
        {{ if $showToc }}
          <div class="order-first lg:ml-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs">
            <div class="toc ps-5 print:hidden lg:sticky {{ $topClass }}">
              {{ if $showToc }}
                {{ partial "toc.html" . }}
              {{ end }}
            </div>
          </div>
        {{ end }}

        <div class="min-w-0 min-h-0">
          {{ partial "series/series.html" . }}
          <div class="article-content mb-20">
            {{ .Content }}
            {{ $defaultReplyByEmail := site.Params.replyByEmail }}
            {{ $replyByEmail := default $defaultReplyByEmail .Params.replyByEmail }}
            {{ if $replyByEmail }}
              <strong class="block mt-8">
                <a
                  target="_blank"
                  class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
                  href="mailto:{{ site.Params.Author.email }}?subject={{ replace (printf "Reply to %s" .Title) "\"" "'" }}">
                  Reply by Email
                </a>
              </strong>
            {{ end }}
          </div>
          {{ if (.Params.showAuthorBottom | default (site.Params.article.showAuthorBottom | default false)) }}
            {{ template "SingleAuthor" . }}
          {{ end }}
          {{ partial "series/series-closed.html" . }}
          {{ partial "sharing-links.html" . }}
          {{ partial "related.html" . }}
        </div>

        {{ $translations := .AllTranslations }}
        {{ with .File }}
          {{ $path := .Path }}
          {{ range $translations }}
            {{ $lang := print "."  .Lang  ".md" }}
            {{ $path = replace $path $lang ".md" }}
          {{ end }}
          {{ $jsPage := resources.Get "js/page.js" }}
          {{ $jsPage = $jsPage | resources.Minify | resources.Fingerprint (site.Params.fingerprintAlgorithm | default "sha512") }}
          <script
            type="text/javascript"
            src="{{ $jsPage.RelPermalink }}"
            integrity="{{ $jsPage.Data.Integrity }}"
            data-oid="views_{{ $path }}"
            data-oid-likes="likes_{{ $path }}"></script>
        {{ end }}
      </section>

      {{/* Footer */}}
      <footer class="pt-8 print:hidden">
        {{ partial "article-pagination.html" . }}
        {{ if .Params.showComments | default (site.Params.article.showComments | default false) }}
          {{ if templates.Exists "partials/comments.html" }}
            <div class="pt-3">
              <hr class="border-dotted border-neutral-300 dark:border-neutral-600">
              <div class="pt-3">
                {{ partial "comments.html" . }}
              </div>
            </div>
          {{ else }}
            {{ warnf "[BLOWFISH] Comments are enabled for %s but no comments partial exists." .File.Path }}
          {{ end }}
        {{ end }}
      </footer>
    </article>
  </div>
{{ end }}

{{ define "SingleAuthor" }}
  {{ $authorsData := site.Data.authors }}
  {{ $taxonomies := site.Taxonomies.authors }}
  {{ $baseURL := site.BaseURL }}
  {{ $taxonomyLink := 0 }}
  {{ $showAuthor := 0 }}
  {{ $isAuthorBottom := (.Params.showAuthorBottom | default ( site.Params.article.showAuthorBottom | default false)) }}

  {{ if not (strings.HasSuffix $baseURL "/") }}
    {{ $baseURL = delimit (slice $baseURL "/") "" }}
  {{ end }}

  {{ if .Params.showAuthor | default (site.Params.article.showAuthor | default true) }}
    {{ $showAuthor = 1 }}
    {{ partial "author.html" . }}
  {{ end }}

  {{ range $author := .Page.Params.authors }}
    {{ $authorData := index $authorsData $author }}
    {{- if $authorData -}}
      {{ range $taxonomyname, $taxonomy := $taxonomies }}
        {{ if (eq $taxonomyname $author) }}
          {{ $taxonomyLink = delimit (slice $baseURL "authors/" $author "/") "" }}
        {{ end }}
      {{ end }}

      {{ $finalLink := $taxonomyLink }}
      {{ $currentLang := site.Language.Lang }}
      {{ if eq site.LanguagePrefix "" }}
        {{ $finalLink = printf "%sauthors/%s/" $baseURL $author }}
      {{ else }}
        {{ $finalLink = printf "%s%s/authors/%s/" $baseURL $currentLang $author }}
      {{ end }}
      {{ partial "author-extra.html" (dict "context" . "data" $authorData "link" $finalLink) }}
    {{- end -}}
  {{ end }}

  {{ if or $taxonomyLink $showAuthor }}
    <div class="{{ cond $isAuthorBottom "mb-10" "mb-5" }}"></div>
  {{ end }}
{{ end }}
